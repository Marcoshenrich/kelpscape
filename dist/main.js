!function(){"use strict";class t{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.background=new Image,this.background.src="./dist/art/intro.png",this.bgHeight=648,this.bgWidth=1440,this.xOffset=0,this.yOffset=0,this.looptracker=0,this.simTransition=!1,this.simStart=!1,this.fader=0,this.mobile=e,this.textMargin=e?25:100,this.sequenceStep=0,this.fontSize=42,this.leading=50,this.animate(),this.textFader=1,this.fadeText=!0,this.fadeTransitionSpeed=.01}animate(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.updatePos(),this.drawDynamicBackground(),this.drawIntroSequence(),this.simTransition&&this.simStarter()}fadeManger(){this.textFader>5&&(this.textFader=1,this.fadeText=!0),this.fadeText?this.textFader-=this.fadeTransitionSpeed:this.textFader+=this.fadeTransitionSpeed,this.textFader<0&&(this.sequenceStep++,this.textFader=0,this.fadeText=!1,this.font=42)}fontAndLeadingManager(t,e){e?t>this.canvas.width-2*this.textMargin?(this.fontSize-=1,this.leading-=1):t<this.canvas.width-3*this.textMargin&&(this.fontSize+=1,this.leading+=1):t>this.canvas.width/2+this.textMargin?(this.fontSize-=1,this.leading-=1):t<this.canvas.width/2&&(this.fontSize+=1,this.leading+=1)}drawIntroSequence(){const t=this.canvas.width/2,e=this.canvas.height/2;if(0===this.sequenceStep)this.ctx.fillStyle=`rgba(0,0,0,${this.textFader})`,this.ctx.font=`${this.fontSize}px Georgia`,this.drawText("Start",!0);else if(1===this.sequenceStep)this.ctx.fillStyle=`rgba(0,0,0,${this.textFader})`,this.ctx.font=`${this.fontSize}px Georgia`,this.drawText("Start",!0),this.fadeText?this.textFader-=this.fadeTransitionSpeed:this.textFader+=this.fadeTransitionSpeed,this.textFader<0&&(this.sequenceStep++,this.textFader=0,this.fadeText=!1);else if(2===this.sequenceStep)this.ctx.font=`${this.fontSize}px Georgia`,this.ctx.fillStyle=`rgba(0,0,0,${this.textFader})`,this.fontAndLeadingManager(this.ctx.measureText("Pacific Kelp Forests stretch from Baja California,").width),this.ctx.fillText("Pacific Kelp Forests stretch from Baja California,",this.textMargin,this.textMargin),this.ctx.fillText("up through the Bering Sea,",this.textMargin,this.textMargin+this.leading),this.ctx.fillText("down to the southern coast of Japan.",this.textMargin,this.textMargin+2*this.leading),this.fadeManger();else if(3===this.sequenceStep)this.ctx.font=`${this.fontSize}px Georgia`,this.ctx.fillStyle=`rgba(0,0,0,${this.textFader})`,this.fontAndLeadingManager(this.ctx.measureText("and were once teeming with life.").width),this.ctx.fillText("These massive marine ecosystems",this.textMargin,this.textMargin),this.ctx.fillText("are home to hundreds of species",this.textMargin,this.textMargin+this.leading),this.ctx.fillText("and were once teeming with life.",this.textMargin,this.textMargin+2*this.leading),this.fadeManger();else if(4===this.sequenceStep){this.ctx.font=`${this.fontSize}px Georgia`,this.ctx.fillStyle=`rgba(0,0,0,${this.textFader})`;const s=this.ctx.measureText("Today, climate change and overfishing").width,i=this.ctx.measureText("threaten these incredible biospheres.").width;this.fontAndLeadingManager(this.ctx.measureText(i,!0)),this.ctx.fillText("Today, climate change and overfishing",t-s/2,e-this.leading/2),this.ctx.fillText("threaten these incredible biospheres.",t-i/2,e+this.leading/2),this.fadeManger()}else if(5===this.sequenceStep){this.ctx.font=`${this.fontSize}px Georgia`,this.ctx.fillStyle=`rgba(0,0,0,${this.textFader})`;const s=this.ctx.measureText("Dive into the hidden").width,i=this.ctx.measureText("world of Kelpscape").width;this.ctx.fillText("Dive into the hidden",t-s/2,e-this.leading/2),this.ctx.fillText("world of Kelpscape",t-i/2,e+this.leading/2),this.fadeManger()}else if(6===this.sequenceStep)this.ctx.fillStyle=`rgba(0,0,0,${this.fader})`,this.fader+=.005,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fader>1&&(this.sequenceStep+=1);else if(7===this.sequenceStep){if(this.ctx.fillStyle=`rgba(0,0,0,${this.fader})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font=.8*this.fontSize+"px Georgia",this.ctx.fillStyle=`rgba(255,255,255,${this.textFader})`,this.mobile){const s=this.ctx.measureText("Navigate the sea using the touchscreen.").width,i=this.ctx.measureText("Click on a denizen to learn more about them.").width;this.fontAndLeadingManager(this.ctx.measureText(i,!0)),this.ctx.fillText("Navigate the sea using the touchscreen.",t-s/2,e-this.leading),this.ctx.fillText("Click on a denizen to learn more about them.",t-i/2,e+this.leading)}else{const s=this.ctx.measureText("Use the arrow keys or mouse to move around.").width,i=this.ctx.measureText("Click on a denizen to learn more about them.").width;this.fontAndLeadingManager(this.ctx.measureText(i,!0)),this.ctx.fillText("Use the arrow keys or mouse to move around.",t-s/2,e-this.leading),this.ctx.fillText("Click on a denizen to learn more about them.",t-i/2,e+this.leading)}this.fadeManger()}else 8===this.sequenceStep&&(this.ctx.fillStyle=`rgba(0,0,0,${this.fader})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.simStart=!0)}updatePos(){this.looptracker+=.5}drawText(t,e){const s=this.canvas.width/2,i=this.canvas.height/2,h=s-this.ctx.measureText(t).width/2,a=i+5;e&&(this.ctx.beginPath(),this.ctx.moveTo(s+25,i+50),this.ctx.lineTo(s-25,i+25),this.ctx.lineTo(s-25,i+75),this.ctx.fill()),this.ctx.fillText(t,h,a)}drawDynamicBackground(){let t=Math.max(this.canvas.width/this.bgWidth,this.canvas.height/this.bgHeight),e=this.bgWidth*t,s=this.bgHeight*t,i=this.canvas.width/2-e/2,h=this.canvas.height/2-s/2;if(this.ctx.drawImage(this.background,i+this.looptracker,h,e,s),i+this.looptracker>=0){let t=i+this.looptracker-e;this.ctx.drawImage(this.background,t+1,h,e,s)}i+this.looptracker-e>0&&(this.looptracker=1-i)}}class e{constructor(){this.allSounds=this.allSoundsObj(),this.volume=.5,this.kickOffIntroScore=!1,this.playingSong=!1,this.songIndexTracker=0}allSoundsObj(){return{intro:{clip:new Audio("./dist/sounds/soundtrack/intro.mp3"),volumePreset:.2},celestia:{clip:new Audio("./dist/sounds/soundtrack/celestia.mp3"),volumePreset:.2},wavesTake:{clip:new Audio("./dist/sounds/soundtrack/waves_take.mp3"),volumePreset:.2}}}playNextTrack(){this.songIndexTracker+=1;let t=Object.keys(this.allSounds)[this.songIndexTracker%Object.keys(this.allSounds).length];this.playSound(t)}playSound(t){this.allSounds[t].clip.volume=0===this.volume?this.volume:this.allSounds[t].volumePreset||this.volume,this.playingSong=this.allSounds[t].clip,this.playingSong.play()}muteAllSounds(){this.volume=0,Object.values(this.allSounds).forEach((t=>{t.clip.volume=0}))}unmuteAllSounds(){this.volume=.5,Object.values(this.allSounds).forEach((t=>{t.clip.volume=t.volumePreset||this.volume}))}playIntroScore(){this.playSound("intro"),this.kickOffIntroScore=!0}}class s{constructor(t,e,s,i){this.ctx=t,this.canvas=e,this.view=s,this.logic=i,this.dead=!1,this.arenaHeight=this.view.arenaHeight,this.arenaWidth=this.view.arenaWidth,this.offset=this.view.offset,this.mateHeart=new Image,this.mateHeart.src="./dist/art/red-heart.png",this.clearOnDeath=[],this.trapped=!1,this.trappedPosDelta=[]}beforeIDieCB(){this.clearOnDeath.forEach((t=>{clearTimeout(t)}))}drawDenizen(){this.ctx.drawImage(this.img,this.pos[0]+this.offset[0],+this.pos[1]+this.offset[1],this.width,this.height)}afterIEatCB(){}afterITrapCB(){}}class i extends s{constructor(t,e,s,i,h,a){super(e,s,i,h),this.textBox=this.logic.textContentObj["Sea Urchin"],this.type="SeaUrchin",this.id=this.type+t,this.img=new Image,this.img.src="./dist/art/sea_urchin.png",this.height=10,this.width=20,this.seaweed=a.parent,this.pos=[a.pos[0]+8,a.pos[1]+this.height+20]}coreloop(){if(this.drawDenizen(),this.seaweed.dead&&this.logic.recentlyDeadDenizens.push(this),this.trapped)return this.pos[0]=this.trapped[0]-this.trappedPosDelta[0],void(this.pos[1]=this.trapped[1]-this.trappedPosDelta[1]);this.dieWhenSeaweedDies()}dieWhenSeaweedDies(){this.seaweed.dead&&(this.dead=!0,this.logic.recentlyDeadDenizens.push(this))}}const h=(t,e)=>e?Math.floor(Math.random()*(e-t))+t+1:Math.floor(Math.random()*t),a=()=>Math.floor(1e3*Math.random())/1e3;class o{constructor(t){this.denizen=t,this.bobCoef=Math.floor(10*Math.random())+4,this.bobSpeed=(Math.floor(3*Math.random())+.1)/30,this.trackCoef=0,this.bobUp=[!0,!1][Math.floor(2*Math.random())]}coreloop(){this.bob()}bob(){if(this.denizen.trapped)return this.denizen.pos[0]=this.denizen.trapped[0]-this.denizen.trappedPosDelta[0],void(this.denizen.pos[1]=this.denizen.trapped[1]-this.denizen.trappedPosDelta[1]);this.bobUp?(this.trackCoef-=this.bobSpeed,this.denizen.pos[1]-=this.bobSpeed):(this.trackCoef+=this.bobSpeed,this.denizen.pos[1]>this.arenaHeight-this.height||(this.denizen.pos[1]+=this.bobSpeed)),this.trackCoef>this.bobCoef&&(this.bobUp=!0),this.trackCoef<0&&(this.bobUp=!1)}}class r extends s{constructor(t,e,s,i,h,a){super(e,s,i,h),this.floater=new o(this),this.textBox=this.logic.textContentObj.Algae,this.clustersObj=a.clustersObj,this.type="Algae",this.id=this.type+t,this.img=new Image,this.img.src="./dist/art/algae.png",this.height=8,this.width=8,this.pos=this.placer(),this.bobCoef=Math.floor(10*Math.random())+4,this.bobSpeed=(Math.floor(3*Math.random())+.1)/30,this.trackCoef=0,this.up=[!0,!1][Math.floor(2*Math.random())],this.energyVal=10}placer(){let t=[],e=Object.values(this.clustersObj)[h(Object.values(this.clustersObj).length)];return t[0]=h(e.pos[0]-e.width/2,e.pos[0]+e.width/2),t[1]=h(e.tallestPoint,this.arenaHeight),t}coreloop(){this.drawDenizen(),this.floater.coreloop(),this.clustersObj=this.logic.seaweedClusters}}class n extends s{constructor(t,e,s,i){super(t,e,s,i),this.up=[!0,!1][Math.floor(2*Math.random())],this.right=[!0,!1][Math.floor(2*Math.random())],this.leftImg=new Image,this.rightImg=new Image,this.img=this.imgSelector(),this.recentlySwitchedDirections=!1,this.movementSwitchTimer(),this.timeToSwitchMovement=!1,this.dangerZone=[this.width+10,this.arenaWidth-this.width-10],this.evaluateDangerZone=!1,this.inDangerZone=!1,this.escapingDangerZone=!1}coreloop(){this.inDangerZone&&this.escapingDangerZone?this.pos[0]<0+this.width?this.pos[0]+=.3:this.pos[0]-=.3:this.move(),this.mouthEater?this.mouthEater.coreloop():this.mouthPos=this.mouthPlacer(),this.consumeEnergy(),this.draw(),!this.dead||this.spawn&&this.foodEaten===this.growUpThreshold||this.logic.denizenCorpse(this),this.behaviorChanger(),this.dangerZoneProtocol()}dangerZoneProtocol(){this.pos[0]<this.dangerZone[0]||this.pos[1]>this.dangerZone[1]?this.inDangerZone||(setTimeout((()=>{this.inDangerZone&&(this.escapingDangerZone=!0),setTimeout((()=>{this.escapingDangerZone=!1}),1e3)}),1e3),this.inDangerZone=!0):this.inDangerZone=!1}behaviorChanger(){!this.hunting&&this.energy<this.huntingThreshold&&this.logic.hungryDenizenArr.push(this),!this.spawn&&!this.seekingMate&&this.energy>this.matingThreshold?(this.logic.matingDenizensObj[this.id]=this,this.seekingMate=!0):!this.spawn&&this.seekingMate&&this.energy<this.matingThreshold&&(delete this.logic.matingDenizensObj[this.id],this.seekingMate=!1),this.energy>this.maxEnergy-1&&(this.hunting=!1,this.eatingSeagrass=!1)}movementSwitchTimer(){let t=setTimeout((()=>{this.timeToSwitchMovement=!0,this.movementSwitchTimer()}),Math.floor(25e3*Math.random())+7e3);this.clearOnDeath.push(t)}imgSelector(){return this.right?this.rightImg:this.leftImg}switchDirections(){this.recentlySwitchedDirections||(this.right=!this.right,this.img=this.imgSelector(),this.recentlySwitchedDirections=!0,setTimeout((()=>{this.recentlySwitchedDirections=!1}),1500))}imgSelector(){return this.right?this.rightImg:this.leftImg}move(){return this.trapped?(this.pos[0]=this.trapped[0]-this.trappedPosDelta[0],void(this.pos[1]=this.trapped[1]-this.trappedPosDelta[1])):((this.pos[0]>this.arenaWidth-this.width||this.pos[0]<0)&&this.switchDirections(),(this.pos[1]>this.arenaHeight-this.height||this.pos[1]<0)&&(this.up=!this.up),this.speed<.01&&(this.speed=.3),this.oldPos=[this.pos[0],this.pos[1]],!this.mating&&this.hunting?(this.moveTowardsFood(),void this.swimmerOrienter()):this.fleeing?(this.fleeFromPredator(),void this.swimmerOrienter()):void(this.mating||this.hunting||(this.timeToSwitchMovement&&(Object.values(this.movementSwitches)[Math.floor(Math.random()*Object.values(this.movementSwitches).length)](),this.timeToSwitchMovement=!1),this.movement1(),this.movement2(),this.swimmerOrienter())))}fleeFromPredator(){let[t,e,s,i]=this.inBounds();this.pos[0]>this.fleeFromCoords[0]?t?this.pos[0]+=this.maxSpeed:this.pos[0]=this.arenaWidth-this.width:e?this.pos[0]-=this.maxSpeed:this.pos[0]=0,this.pos[1]>this.fleeFromCoords[1]?s?this.pos[1]+=this.maxSpeed:this.pos[1]=this.arenaHeight-this.height:i?this.pos[1]-=this.maxSpeed:this.pos[1]=0}inBounds(){let t=!0,e=!0,s=!0,i=!0;return this.pos[0]<0&&(e=!1),this.pos[0]>this.arenaWidth-this.width&&(t=!1),this.pos[1]<0&&(i=!1),this.pos[1]>this.arenaHeight-this.height&&(s=!1),[t,e,s,i]}movementPatterns={scan:()=>{this.right?this.pos[0]+=this.speed/2:this.pos[0]-=this.speed/2},crissCross:()=>{this.movementPatterns.scan(),this.movementPatterns.bob()},bob:()=>{this.up?this.pos[1]+=this.speed/2:this.pos[1]-=this.speed/2}};movementSwitches={reverseUp:()=>{this.up=!this.up},reverseSide:()=>{this.right=!this.right,this.img=this.imgSelector()},speedUp:()=>{this.speed<this.maxSpeed&&(this.speed+=.1)},slowDown:()=>{this.speed>.3&&(this.speed-=.1)},dash:()=>{this.speed+=.5,setTimeout((()=>this.speed-=.5),500)}};swimmerOrienter(){this.recentlySwitchedDirections||(this.oldPos[0]<this.pos[0]?(this.right=!0,this.img=this.imgSelector(),this.recentlySwitchedDirections=!0,setTimeout((()=>{this.recentlySwitchedDirections=!1}),1500)):(this.right=!1,this.img=this.imgSelector(),this.recentlySwitchedDirections=!0,setTimeout((()=>{this.recentlySwitchedDirections=!1}),1500)))}moveTowardsFood(){let[t,e,s,i]=this.inBounds();this.mouthEater?(this.mouthEater.mouthPos[0]<this.nearestFoodCords[0]?t&&(this.pos[0]+=this.maxSpeed):e&&(this.pos[0]-=this.maxSpeed),this.mouthEater.mouthPos[1]<this.nearestFoodCords[1]?s&&(this.pos[1]+=this.maxSpeed):i&&(this.pos[1]-=this.maxSpeed)):(this.mouthPos[0]<this.nearestFoodCords[0]?t&&(this.pos[0]+=this.maxSpeed):e&&(this.pos[0]-=this.maxSpeed),this.mouthPos[1]<this.nearestFoodCords[1]?s&&(this.pos[1]+=this.maxSpeed):i&&(this.pos[1]-=this.maxSpeed))}moveSelector=()=>Object.values(this.movementPatterns)[Math.floor(2*Math.random())];moveChangerOne(){this.movement1=this.moveSelector();let t=setTimeout((()=>{this.moveChangerOne()}),Math.floor(3e3*Math.random()));this.clearOnDeath.push(t)}moveChangerTwo(){this.movement2=this.moveSelector();let t=setTimeout((()=>{this.moveChangerTwo()}),Math.floor(3e3*Math.random()));this.clearOnDeath.push(t)}consumeEnergy(){this.energy-=this.energyUseCoef*this.speed,this.energy<.05&&(this.dead=!0,this.logic.recentlyDeadDenizens.push(this),this.logic.denizenCorpse(this))}mouthPlacer(){let t=[];return t=this.right?[this.pos[0]+(this.width-this.mouthSize),this.pos[1]+this.height/2]:[this.pos[0],this.pos[1]+this.height/2],t}}class l{constructor(t,e){this.denizen=t,this.mouthHeight=e.mouthHeight,this.mouthWidth=e.mouthWidth,this.leftMouthYAdjustment=e.leftMouthYAdjustment,this.leftMouthXAdjustment=e.leftMouthXAdjustment,this.rightMouthYAdjustment=e.rightMouthYAdjustment,this.rightMouthXAdjustment=e.rightMouthXAdjustment,this.mouthPos=[0,0]}coreloop(){this.mouthPlacer()}mouthPlacer(){return this.denizen.right?(this.mouthPos[0]=this.denizen.pos[0]+this.rightMouthXAdjustment,this.mouthPos[1]=this.denizen.pos[1]+this.rightMouthYAdjustment):(this.mouthPos[0]=this.denizen.pos[0]+this.leftMouthXAdjustment,this.mouthPos[1]=this.denizen.pos[1]+this.leftMouthYAdjustment),[]}}class c extends n{constructor(t,e,s,i,h){super(t,e,s,i),this.spawn=!1,this.movement1=this.moveSelector(),this.movement2=this.moveSelector(),this.moveChangerOne(),this.moveChangerTwo(),this.width=h.width,this.height=h.height,this.mouthSize=h.mouthSize,this.pos=h.pos||this.placer(),this.fadeThreshold=7,this.mating=!1,this.seekingMate=!1,this.foodEaten=0,this.hunting=!1,this.nearestFoodCords=[],this.fleeDistanceThreshold=200,this.fleeing=!1,this.fleeFromCoords=[],this.afterIEatCB=()=>{},this.mouthEater=new l(this,{mouthHeight:this.mouthSize,mouthWidth:this.mouthSize,leftMouthYAdjustment:this.height/2,leftMouthXAdjustment:0,rightMouthXAdjustment:this.width-this.mouthSize,rightMouthYAdjustment:this.height/2})}placer(){let t=[];return t[0]=Math.floor(Math.random()*(this.arenaWidth-this.width)),t[1]=Math.floor(Math.random()*(this.arenaHeight-this.height)),t}draw(){this.ctx.fillStyle="rgba(0,225,225,1)",this.ctx.globalAlpha=this.energy>7?1:(this.energy+3)/10,this.drawDenizen(),this.mating&&this.ctx.drawImage(this.mateHeart,this.mouthEater.mouthPos[0]+this.offset[0],this.mouthEater.mouthPos[1]+this.offset[1]-this.width,15,15),this.view.debugging,this.drawId(),this.ctx.globalAlpha=1}drawId(){this.ctx.fillStyle="rgba(255,255,255,1)",this.ctx.font="12px serif"}mate(t){this.mating=!0,this.speed=0,this.energy-=this.matingEnergyCost;let e=setTimeout((()=>{if(this.speed+=.5,this.mating=!1,t)return;let e=Math.floor(6*Math.random());for(;e>0;)e--,this.logic.spawnDenizen(this)}),1500);this.clearOnDeath.push(e)}}class d extends c{constructor(t,e,s,i,h,a){super(e,s,i,h,{...a,width:30,height:15,mouthSize:8}),this.type="Garabaldi",this.textBox=this.logic.textContentObj.Garibaldi,this.id=this.type+t,this.leftImg.src="./dist/art/fishes/garabaldileft.png",this.rightImg.src="./dist/art/fishes/garabaldiright.png",this.speed=(Math.floor(5*Math.random())+1)/10,this.oldPos=this.pos,this.maxEnergy=20,this.energy=this.maxEnergy,this.energyUseCoef=.005,this.matingThreshold=15,this.matingEnergyCost=5,this.maxSpeed=.7,this.energyVal=20,this.mateThreshold=10,this.eatFoodThreshold=15,this.huntingThreshold=7}}class g extends c{constructor(t,e,s,i,h){super(t,e,s,i,h),this.spawn=!0,this.pos=h.pos?[h.pos[0]+a(),h.pos[1]+a()]:this.placer(),this.oldPos=this.pos,this.fadeThreshold=3,this.foodEaten=0,this.growUpThreshold=4,this.hunting=!1,this.nearestFoodCords=[],this.fleeDistanceThreshold=200,this.fleeing=!1,this.fleeFromCoords=[],this.afterIEatCB=()=>{this.foodEaten===this.growUpThreshold&&this.growUp()}}growUp(){this.dead=!0,this.logic.recentlyDeadDenizens.push(this),this.logic.spawnDenizen(this)}}class p extends g{constructor(t,e,s,i,h,a){super(e,s,i,h,{...a,width:15,height:8,mouthSize:4}),this.type="GarabaldiBaby",this.textBox=this.logic.textContentObj.Garibaldi,this.id=this.type+t,this.leftImg.src="./dist/art/fishes/garabaldileft.png",this.rightImg.src="./dist/art/fishes/garabaldiright.png",this.speed=(Math.floor(5*Math.random())+1)/10,this.mouthPos=this.mouthPlacer(),this.maxEnergy=10,this.energy=this.maxEnergy,this.energyUseCoef=.0025,this.maxSpeed=.4,this.energyVal=5,this.eatFoodThreshold=8,this.huntingThreshold=6}}class u{constructor(t,e,s,i,h,a){this.id="Effect"+t,this.type=a.type,this.pos=a.pos,this.ctx=e,this.canvas=s,this.logic=h,this.view=i,this.size=a.size,this.coef1=0,this.coef2=0,this.dead=!1,this.bobCoef=Math.floor(10*Math.random())+4,this.bobSpeed=(Math.floor(3*Math.random())+.1)/30,this.trackCoef=0,this.up=[!0,!1][Math.floor(2*Math.random())],this.index=0,this.frame=0,this.parent=a.parent,this.rbgGreen=a.rbgGreen,this.fader=1,this.delta=a.delta,this.parent&&this.parentPosDeltafinder()}parentPosDeltafinder(){this.parentPosDelta=[this.pos[0]-this.parent.pos[0],this.pos[1]-this.parent.pos[1]]}coreloop(){switch(this.type){case"bloodSpurt":this.bloodSpurt();break;case"gametes":this.gametes();break;case"eatingSeaweed":this.eatingSeaweed();break;case"particle":this.particle();break;default:return}}eatingSeaweed(){if(this.frame++,this.frame%5!=0)return;let t=[[0,-.1],[.075,-.075],[.1,0],[.075,.075],[0,.1],[-.075,.075],[-.1,0],[-.075,-.075]];this.logic.effectCount++,this.logic.effects["Effect"+this.logic.effectCount]=new u(this.logic.effectCount,this.ctx,this.canvas,this.view,this.logic,{type:"particle",pos:[this.pos[0],this.pos[1]],delta:t[this.index],size:2,rbgGreen:255}),this.index=(this.index+1)%t.length,this.parentPosDelta&&(this.pos[0]=this.parent.pos[0]+this.parentPosDelta[0],this.pos[1]=this.parent.pos[1]+this.parentPosDelta[1],this.parent.eatingSeagrass||(this.dead=!0,this.logic.recentlyDeadDenizens.push(this)))}particle(){this.ctx.fillStyle=`rgba(0,${this.rbgGreen},0,${this.fader})`,this.ctx.fillRect(this.pos[0]+this.view.offset[0],this.pos[1]+this.view.offset[1],this.size,this.size),this.pos[0]+=this.delta[0],this.pos[1]+=this.delta[1],this.rbgGreen-=1.25,this.fader-=.005,this.fader<0&&(this.dead=!0,this.view.logic.recentlyDeadDenizens.push(this))}gametes(){this.ctx.fillStyle="rgba(0,255,255,1)",this.ctx.globalAlpha=.3,this.ctx.fillRect(this.pos[0]+this.view.offset[0],this.pos[1]+15+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]+5+this.view.offset[0],this.pos[1]+10+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]+10+this.view.offset[0],this.pos[1]+15+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]+15+this.view.offset[0],this.pos[1]+10+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]+this.view.offset[0],this.pos[1]+5+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]+5+this.view.offset[0],this.pos[1]+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]+10+this.view.offset[0],this.pos[1]+5+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]+15+this.view.offset[0],this.pos[1]+this.view.offset[1],this.size,this.size),this.pos[1]+=.1,this.ctx.globalAlpha=1,this.pos[1]>this.view.arenaHeight&&(this.dead=!0,this.view.logic.recentlyDeadDenizens.push(this),this.view.logic.spawnDenizen(this))}bloodSpurt(){this.ctx.fillStyle="rgba(255,0,0,1)",this.ctx.fillRect(this.pos[0]+this.coef1+this.view.offset[0],this.pos[1]+this.coef2+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]+this.coef1+this.view.offset[0],this.pos[1]-this.coef2+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]-this.coef1+this.view.offset[0],this.pos[1]+this.coef2+this.view.offset[1],this.size,this.size),this.ctx.fillRect(this.pos[0]-this.coef1+this.view.offset[0],this.pos[1]-this.coef2+this.view.offset[1],this.size,this.size),this.coef1+=.7,this.coef2+=.7,this.size-=.3,this.size<0&&(this.dead=!0,this.view.logic.recentlyDeadDenizens.push(this))}beforeIDieCB(){}}class f extends n{constructor(t,e,s,i,h,a){super(e,s,i,h),this.textBox=this.logic.textContentObj.Shark,this.type="Shark",this.id=this.type+t,this.leftImg.src="./dist/art/sharkleft.png",this.rightImg.src="./dist/art/sharkright.png",this.mateHeart=new Image,this.mateHeart.src="./dist/art/red-heart.png",this.speed=(Math.floor(5*Math.random())+5)/10,this.width=a?20:100,this.height=a?8:41,this.pos=this.placer(),this.oldPos=this.pos,this.movement1=this.moveSelector(),this.movement2=this.moveSelector(),this.moveChangerOne(),this.moveChangerTwo(),this.seekingMate=!1,this.mateThreshold=70,this.maxEnergy=100,this.energy=this.maxEnergy,this.fadeThreshold=7,this.energyUseCoef=.005,this.matingThreshold=15,this.matingEnergyCost=5,this.maxSpeed=a?.3:1,this.mating=!1,this.spawn=!!a,this.foodEaten=0,this.huntingThreshold=60,this.eatFoodThreshold=70,this.hunting=!1,this.nearestFoodCords=[],this.afterIEatCB=()=>{this.logic.effectCount++,this.logic.effects["Effect"+this.logic.effectCount]=new u(this.logic.effectCount,this.ctx,this.canvas,this.view,this.logic,{type:"bloodSpurt",pos:[this.mouthEater.mouthPos[0],this.mouthEater.mouthPos[1]],size:10})},this.mouthEater=new l(this,{mouthHeight:12,mouthWidth:12,leftMouthYAdjustment:this.height/2,leftMouthXAdjustment:5,rightMouthXAdjustment:this.width-12-5,rightMouthYAdjustment:this.height/2})}imgSelector(){return this.right?this.rightImg:this.leftImg}placer(){let t=[];return t[0]=Math.floor(Math.random()*(this.arenaWidth-this.width)),t[1]=Math.floor(Math.random()*(this.arenaHeight-this.height)),t}draw(){this.ctx.fillStyle="rgba(0,225,225,1)",this.ctx.globalAlpha=this.energy>this.fadeThreshold?1:(this.energy+Math.abs(this.fadeThreshold-10))/10,this.drawDenizen(),this.view.debugging&&(this.drawMouths(),this.drawId()),this.ctx.globalAlpha=1}drawId(){this.ctx.fillStyle="rgba(0,0,0,1)",this.ctx.font="12px serif",this.ctx.fillText(`${this.energy}`,this.pos[0]+this.offset[0],this.pos[1]+this.offset[1])}mate(){}}class m extends s{constructor(t,e,s,i,h,r){super(e,s,i,h),this.floater=new o(this),this.textBox=this.logic.textContentObj["Fish Egg"],this.id="Fishegg"+t,this.pos=[r.pos[0]+a(),r.pos[1]+a()],this.parent=r.parent,this.img=new Image,this.img.src="./dist/art/fishEggs.png",this.spawn(),this.dims=Math.floor(5*Math.random())+10,this.height=this.dims,this.width=this.dims,this.energyVal=2}coreloop(){this.ctx.draw,this.floater.coreloop(),this.deathChecker(),this.drawDenizen()}deathChecker(){(this.energy<0||this.energyVal<0)&&(this.dead=!0,this.logic.recentlyDeadDenizens.push(this))}spawn(){let t=setTimeout((()=>{this.dead=!0,this.logic.recentlyDeadDenizens.push(this),this.trapped||this.logic.spawnDenizen(this)}),h(15e3,25e3));this.clearOnDeath.push(t)}}class w extends s{constructor(t,e,s,i,h,a){super(e,s,i,h),this.textBox=this.logic.textContentObj.Algae,this.cluster=a.cluster,this.numInCluster=t,this.textBox=this.logic.textContentObj.Kelp,this.type="Seaweed",this.id="Cluster"+this.cluster.id+"Seaweed"+this.numInCluster,this.width=25,this.height=75,this.sizeCoef=Math.floor(15*Math.random()),this.pos=[a.pos[0]+Math.floor(5*Math.random())-10,this.arenaHeight-this.height-25*(t-1)],this.img=new Image,this.img.src="./dist/art/seaweed.png",this.aniStateNames=["sway1","sway2","swish","swoosh"],this.animationState=this.aniStateNames[Math.floor(2*Math.random())],this.animations=this.cluster.animations,this.energyVal=5,this.gameFrame=Math.floor(100*Math.random()),this.staggerFrame=40,this.placeUrchin()}placeUrchin(){h(10)||this.logic.spawnDenizen(this)}coreloop(){let t=Math.floor(this.gameFrame/this.staggerFrame%this.cluster.animations[this.animationState].loc.length),e=this.cluster.animations[this.animationState].loc[t].x,s=this.cluster.animations[this.animationState].loc[t].y;this.ctx.drawImage(this.img,e,s,this.width,this.height,this.pos[0]+this.offset[0],this.pos[1]+this.offset[1],this.width+this.sizeCoef,this.height+this.sizeCoef),this.gameFrame++,this.energyVal<0&&(this.energyVal=5,this.cluster.shrinkSeaweed())}}class b extends s{constructor(t,e,s,i,a,o){super(e,s,i,a),this.id=t,this.ctx=e,this.canvas=s,this.view=i,this.logic=a,this.animationStates=[{name:"sway1",frames:8},{name:"sway2",frames:8},{name:"swish",frames:8},{name:"swoosh",frames:8}],this.animations=[],this.animationFramesSetter(),this.width=60,this.pos=[h(this.width,this.view.arenaWidth-this.width),0],this.seaweedCount=o.start?Math.floor(35*Math.random())+10:1,this.growSeaweedInterval=25e3,this.maxHeight=100,this.seaweed=this.tankPopulator(this.seaweedCount,w,{pos:this.pos,cluster:this}),this.bounds={},this.tallestPoint=this.tallestPointFinder(),this.newSeaweed=!1,this.growSeaweed()}shrinkSeaweed(){let t=this.seaweed[Object.values(this.seaweed)[Object.values(this.seaweed).length-1].id];delete this.seaweed[t.id],this.seaweedCount-=1,t.dead=!0,this.logic.recentlyDeadDenizens.push(t)}tankPopulator(t,e,s){let i={},h=1;for(;h<=t;)i["Cluster"+this.id+e.name+h]=new e(h,this.ctx,this.canvas,this.view,this.logic,s),h++;return i}growSeaweed(){let t=setTimeout((()=>{this.seaweedCount++,this.seaweed["Cluster"+this.id+"Seaweed"+this.seaweedCount]=new w(this.seaweedCount,this.ctx,this.canvas,this.view,this.logic,{pos:this.pos,cluster:this}),this.newSeaweed=!0,this.tallestPoint>this.maxHeight&&this.growSeaweed()}),h(this.growSeaweedInterval)+this.growSeaweedInterval);this.clearOnDeath.push(t)}tallestPointFinder(){return Object.values(this.seaweed)[Object.values(this.seaweed).length-1].pos[1]+10}dieWhenNoSeaweed(){0===this.seaweedCount&&(this.dead=!0,this.seaweed={},this.logic.recentlyDeadDenizens.push(this))}coreloop(){this.newSeaweed&&(this.tallestPoint=this.tallestPointFinder(),this.newSeaweed=!1),this.dieWhenNoSeaweed()}animationFramesSetter(){this.animationStates.forEach(((t,e)=>{let s={loc:[]};for(let i=0;i<t.frames;i++){let t=25*i+17.5+35*i,h=75*e+2.5+5*e;s.loc.push({x:t,y:h})}this.animations[t.name]=s}))}}class y{constructor(t,e){this.denizen=t,this.trapHeight=e.trapHeight,this.trapWidth=e.trapWidth,this.trapYAdjustment=e.trapYAdjustment,this.trapXAdjustment=e.trapXAdjustment,this.denizenEatsImmediately=e.denizenEatsImmediately,this.trapPos=[0,0]}coreloop(){this.denizen.trapPlacer?this.denizen.trapPlacer():this.trapPlacer(),this.denizenEatsImmediately&&this.denizen.trappedPrey&&this.eatTrappedPrey(this.denizen.trappedPrey)}eatTrappedPrey(t){this.denizen.energy=Math.min(this.denizen.maxEnergy,this.denizen.energy+this.denizen.consumptionRate),t.energy-=this.denizen.consumptionRate,this.denizen.totalEnergyConsumed+=this.denizen.consumptionRate,t.dead&&(this.denizen.speed=.2,this.denizen.trappedPrey=!1)}trapPlacer(){this.trapPos[0]=this.denizen.pos[0]+this.trapXAdjustment,this.trapPos[1]=this.denizen.pos[1]+this.trapYAdjustment}}class x extends n{constructor(t,e,s,i,h,a){super(e,s,i,h),this.textBox=this.logic.textContentObj.Crab,this.type="Crab",this.id=this.type+t,this.spawn=!1,this.img=new Image,this.img.src="./dist/art/crab.png",this.height=15,this.width=30,this.pos=a.pos||[Math.floor(Math.random()*this.arenaWidth-this.width),this.arenaHeight-this.height],this.speed=Math.floor(4*Math.random())/10,this.maxSpeed=.4,this.up=!1,this.right=[!0,!1][Math.floor(2*Math.random())],this.recentlySwitchedDirections=!1,this.dead=!1,this.timeToClimbSeaweed=!1,this.onSeaweed=!1,this.seaweedSpots=this.logic.seaweedSpots,this.climbSeaweedTimer(),this.scavenging=!1,this.consumptionRate=.005,this.recentlyAte=!1,this.maxEnergy=10,this.energy=this.maxEnergy,this.fadeThreshold=5,this.energyVal=10,this.energyUseCoef=7e-4,this.matingThreshold=6,this.matingEnergyCost=3,this.mating=!1,this.carryingEggs=!1,this.seekingMate=!1,this.hasGivenBirth=!1,this.trappedPrey=!1,this.totalEnergyConsumed=0,this.trapper=a.spawn?null:new y(this,{trapHeight:10,trapWidth:this.width+10,trapYAdjustment:0,trapXAdjustment:-5,denizenEatsImmediately:!0})}climbSeaweedTimer(){let t=setTimeout((()=>{this.timeToClimbSeaweed=!this.timeToClimbSeaweed,this.climbSeaweedTimer()}),Math.floor(Math.random()*(this.timeToClimbSeaweed?6e4:3e4)));this.clearOnDeath.push(t)}movementSwitchTimer(){let t=setTimeout((()=>{this.timeToSwitchMovement=!0,this.movementSwitchTimer()}),Math.floor(2500*Math.random())+7e3);this.clearOnDeath.push(t)}coreloop(){this.trapper&&this.trapper.coreloop(),this.scavenging&&this.consumeFod(this.scavenging,"scavenge"),this.scavenging||this.move(),this.consumeEnergy(),this.behaviorChanger(),this.draw(),!this.dead||this.spawn&&this.totalEnergyConsumed>this.growUpThreshold||this.logic.denizenCorpse(this)}behaviorChanger(){!this.spawn&&!this.hasGivenBirth&&!this.seekingMate&&this.energy>this.matingThreshold&&this.recentlyAte&&!this.carryingEggs?(this.logic.matingDenizensObj[this.id]=this,this.seekingMate=!0):!this.spawn&&this.seekingMate&&this.energy<this.matingThreshold&&(delete this.logic.matingDenizensObj[this.id],this.seekingMate=!1)}mate(t){this.mating=!0,this.seekingMate=!1,this.speed=0,this.energy-=this.matingEnergyCost;let e=setTimeout((()=>{if(this.speed+=.2,this.mating=!1,t)return;this.carryingEggs=!0,this.img.src="./dist/art/crabdad.png";let e=setTimeout((()=>{if(this.trapped)return;this.img.src="./dist/art/crab.png",this.carryingEggs=!1,this.hasGivenBirth=!0;let t=Math.floor(3*Math.random())+2;for(;t>0;)t--,this.logic.spawnDenizen(this)}),3e4);this.clearOnDeath.push(e)}),3e3);this.clearOnDeath.push(e)}consumeEnergy(){this.energy-=this.energyUseCoef*this.speed,this.energy<.01&&(this.dead=!0,this.logic.recentlyDeadDenizens.push(this))}draw(){this.ctx.globalAlpha=this.energy>this.fadeThreshold?1:(this.energy+Math.abs(this.fadeThreshold-10))/10,this.drawDenizen(),this.ctx.globalAlpha=1,this.mating&&this.ctx.drawImage(this.mateHeart,this.pos[0]+8.5+this.offset[0],this.pos[1]+this.offset[1]-17,15,15),this.view.debugging&&(this.ctx.fillStyle="rgba(255,255,255,1)",this.ctx.font="12px serif",this.ctx.fillRect(this.trapPos[0]+this.offset[0],this.trapPos[1]+this.offset[1],this.trapWidth,this.trapHeight),this.ctx.fillText(`${this.id}`,this.pos[0]+this.offset[0],this.pos[1]+this.offset[1]),this.ctx.fillText(`[${Math.floor(this.pos[0])},${Math.floor(this.pos[1])}]`,this.pos[0]+this.offset[0],this.pos[1]+this.offset[1]-this.height))}travelLand(){(this.pos[0]>this.arenaWidth-this.width||this.pos[0]<0)&&this.switchDirections(),this.pos[1]+this.height>this.arenaHeight&&(this.pos[1]=this.arenaHeight-this.height),this.right?this.pos[0]+=this.speed:this.pos[0]-=this.speed}climbSeaweed(t){if(t)return(this.pos[1]<this.onSeaweed.tallestPoint+this.height||this.pos[1]>this.arenaHeight-this.height)&&this.switchDirections(),void(this.right?this.pos[1]-=this.speed:this.pos[1]+=this.speed);this.pos[1]+=this.speed,this.pos[1]>this.arenaHeight-this.height&&(this.onSeaweed=!1)}move(){if(this.trapped)return this.pos[0]=this.trapped[0]-this.trappedPosDelta[0],void(this.pos[1]=this.trapped[1]-this.trappedPosDelta[1]);this.mating||(!this.onSeaweed&&this.timeToClimbSeaweed&&Math.floor(this.pos[0])in this.seaweedSpots&&(this.onSeaweed=this.seaweedSpots[Math.floor(this.pos[0])]),!this.onSeaweed||this.timeToClimbSeaweed?(this.onSeaweed?this.climbSeaweed(!0):this.travelLand(),this.timeToSwitchMovement&&(Object.values(this.movementSwitches)[Math.floor(Math.random()*Object.values(this.movementSwitches).length)](),this.timeToSwitchMovement=!1)):this.climbSeaweed(!1))}movementSwitches={reverseSide:()=>{this.right=!this.right},reverseSide2:()=>{this.right=!this.right},speedUp:()=>{this.speed<this.maxSpeed&&(this.speed+=.05)},slowDown:()=>{this.speed>.1&&(this.speed-=.05)},chill:()=>{this.speed=0,setTimeout((()=>{this.speed=.3}),Math.floor(9e3*Math.random())+1e3)}};switchDirections(){this.recentlySwitchedDirections||(this.right=!this.right,this.recentlySwitchedDirections=!0,setTimeout((()=>{this.recentlySwitchedDirections=!1}),350))}beforeIDieCB(){this.trappedPrey&&(this.trappedPrey.trapped=!1),this.clearOnDeath.forEach((t=>{clearTimeout(t)}))}consumeFod(t,e){this.energy=Math.min(this.maxEnergy,this.energy+this.consumptionRate),t.energyVal-=this.consumptionRate,this.totalEnergyConsumed+=this.consumptionRate,t.pos[1]>this.pos[1]+this.height&&(this.scavenging=!1),t.dead&&(this.speed=.3,this.scavenging=!1),this.spawn&&this.totalEnergyConsumed>this.growUpThreshold&&this.growUp(),this.recentlyAte||this.scavenging||(this.recentlyAte=!0,setTimeout((()=>this.recentlyAte=!1),1e4))}}class v extends x{constructor(t,e,s,i,h,o){super(t,e,s,i,h,{spawn:!0}),this.spawn=!0,this.type="CrabBaby",this.id=this.type+t,this.img=new Image,this.img.src="./dist/art/crab.png",this.height=7.5,this.width=15,this.pos=[o.pos[0]+a(),this.arenaHeight-this.height],this.speed=Math.floor(4*Math.random())/20,this.maxSpeed=.25,this.energyVal=5,this.consumptionRate=.002,this.growUpThreshold=1,this.maxEnergy=5,this.energy=this.maxEnergy,this.energyUseCoef=7e-4,this.fadeThreshold=2.5}growUp(){this.dead=!0,this.logic.recentlyDeadDenizens.push(this),this.logic.spawnDenizen(this)}}var S=class extends s{constructor(t,e,s,i,a){super(e,s,i,a),this.textBox=this.logic.textContentObj.Rock,this.id="Rock"+t,this.img=new Image,this.rockKeys=["small_rock","small_rock_2","small_green","med_rock","med_rock_2","rock_pile","tall_med","boulder_1","boulder_2","arch"],this.rockRoll=this.rockKeys[h(this.rockKeys.length)],this.width,this.height,this.rockSelector(),this.pos=[Math.floor(Math.random()*this.arenaWidth-this.width/2),this.arenaHeight-this.height]}coreloop(){this.draw()}draw(){this.drawDenizen()}rockSelector(){switch(this.rockRoll){case"small_rock":this.img.src="./dist/art/rocks/small_rock.png",this.width=h(20,50),this.height=.4*this.width;break;case"small_rock_2":this.img.src="./dist/art/rocks/small_rock_2.png",this.width=h(10,50),this.height=.7*this.width;break;case"small_green":this.img.src="./dist/art/rocks/small_rock_green.png",this.width=h(20,60),this.height=1.1*this.width;break;case"med_rock":this.img.src="./dist/art/rocks/med_rock.png",this.width=h(40,80),this.height=.6*this.width;break;case"med_rock_2":this.img.src="./dist/art/rocks/med_rock_2.png",this.width=h(20,60),this.height=1.1*this.width;break;case"rock_pile":this.img.src="./dist/art/rocks/rock_pile.png",this.width=h(20,60),this.height=.9*this.width;break;case"tall_med":this.img.src="./dist/art/rocks/tall_med.png",this.width=h(15,35),this.height=2*this.width;break;case"boulder_1":this.img.src="./dist/art/rocks/boulder_1.png",this.width=h(40,120),this.height=.5*this.width;break;case"boulder_2":this.img.src="./dist/art/rocks/boulder_2.png",this.width=h(20,100),this.height=.65*this.width;break;case"arch":this.img.src="./dist/art/rocks/arch.png",this.width=h(100,140),this.height=.45*this.width}}};class k extends g{constructor(t,e,s,i,h,a){super(e,s,i,h,{...a,width:20,height:17,mouthSize:4}),this.type="BassBaby",this.id=this.type+t,this.leftImg.src="./dist/art/fishes/bassleft.png",this.rightImg.src="./dist/art/fishes/bassright.png",this.textBox=this.logic.textContentObj["Kelp Bass"],this.speed=(Math.floor(5*Math.random())+1)/10,this.mouthPos=this.mouthPlacer(),this.maxEnergy=12,this.energy=this.maxEnergy,this.energyUseCoef=.003,this.maxSpeed=.25,this.energyVal=5,this.eatFoodThreshold=9,this.huntingThreshold=7}}class T extends c{constructor(t,e,s,i,h,a){super(e,s,i,h,{...a,width:45,height:35,mouthSize:10}),this.type="Bass",this.id=this.type+t,this.leftImg.src="./dist/art/fishes/bassleft.png",this.rightImg.src="./dist/art/fishes/bassright.png",this.speed=(Math.floor(5*Math.random())+1)/10,this.textBox=this.logic.textContentObj["Kelp Bass"],this.oldPos=this.pos,this.maxEnergy=25,this.energy=this.maxEnergy,this.energyUseCoef=.0025,this.matingThreshold=18,this.matingEnergyCost=6,this.maxSpeed=.45,this.energyVal=25,this.mateThreshold=20,this.eatFoodThreshold=17,this.huntingThreshold=15}}class C extends c{constructor(t,e,s,i,h,a){super(e,s,i,h,{...a,width:30,height:19,mouthSize:8}),this.type="Rockfish",this.id=this.type+t,this.leftImg.src="./dist/art/fishes/fishleft.png",this.rightImg.src="./dist/art/fishes/fishright.png",this.speed=(Math.floor(5*Math.random())+1)/10,this.textBox=this.logic.textContentObj.Rockfish,this.oldPos=this.pos,this.maxEnergy=20,this.energy=this.maxEnergy,this.energyUseCoef=.005,this.matingThreshold=15,this.matingEnergyCost=5,this.maxSpeed=.4,this.energyVal=20,this.mateThreshold=10,this.eatFoodThreshold=15,this.huntingThreshold=7}}class M extends g{constructor(t,e,s,i,h,a){super(e,s,i,h,{...a,width:15,height:8,mouthSize:4}),this.type="RockfishBaby",this.id=this.type+t,this.leftImg.src="./dist/art/fishes/fishleft.png",this.rightImg.src="./dist/art/fishes/fishright.png",this.textBox=this.logic.textContentObj.Rockfish,this.speed=(Math.floor(5*Math.random())+1)/10,this.mouthPos=this.mouthPlacer(),this.maxEnergy=10,this.energy=this.maxEnergy,this.energyUseCoef=.0025,this.maxSpeed=.3,this.energyVal=5,this.eatFoodThreshold=8,this.huntingThreshold=6}}class D extends s{constructor(t,e,s,i,h,a,o){super(e,s,i,h),this.textBox=this.logic.textContentObj.Corpse,this.type="DeadCreature",this.id=this.type+t,this.pos=[a[0],a[1]],this.driftSpeed=.2,this.img=new Image,this.deadDenizen=o,this.width,this.height,this.energyVal,this.typeSelector(),this.dead=!1}coreloop(){this.pos[1]<this.arenaHeight-this.height&&(this.pos[1]+=this.driftSpeed),this.draw(),this.energyVal<0&&(this.dead=!0,this.logic.recentlyDeadDenizens.push(this))}draw(){this.ctx.globalAlpha=this.energyVal>5?1:(this.energyVal+5)/10,this.drawDenizen(),this.ctx.globalAlpha=1,this.view.debugging&&(this.ctx.fillStyle="rgba(255,255,255,1)",this.ctx.font="12px serif",this.ctx.fillText(`${this.energyVal}`,this.pos[0]+this.offset[0],this.pos[1]+this.offset[1]),this.ctx.fillText(`[${Math.floor(this.pos[0])},${Math.floor(this.pos[1])}]`,this.pos[0]+this.offset[0],this.pos[1]+this.offset[1]-this.height))}typeSelector(){switch(this.deadDenizen.constructor){case f:this.img.src="./dist/art/sharkdead.png",this.width=100,this.height=30,this.energyVal=40;break;case d:this.img.src="./dist/art/fishes/garabaldidead.png",this.width=30,this.height=15,this.energyVal=10;break;case p:this.img.src="./dist/art/fishes/garabaldidead.png",this.width=15,this.height=8,this.energyVal=4;break;case T:this.img.src="./dist/art/fishes/bassdead.png",this.width=45,this.height=35,this.energyVal=10;break;case k:this.img.src="./dist/art/fishes/bassdead.png",this.width=20,this.height=17,this.energyVal=5;break;case C:this.img.src="./dist/art/fishes/fishdead.png",this.width=30,this.height=19,this.energyVal=7;break;case M:this.img.src="./dist/art/fishes/fishdead.png",this.width=30,this.height=19,this.energyVal=4;break;case x:this.img.src="./dist/art/crabdead.png",this.width=30,this.height=15,this.energyVal=5;break;case v:this.img.src="./dist/art/crabdead.png",this.width=15,this.height=7,this.energyVal=2.5;break;default:this.img.src="./dist/art/fishes/fishdead.png"}}}class z extends n{constructor(t,e,s,i,a,r){super(e,s,i,a),this.floater=new o(this),this.trapper=new y(this,{trapHeight:18,trapWidth:18,trapYAdjustment:10,trapXAdjustment:0,denizenEatsImmediately:!0}),this.trappedPrey=!1,this.textBox=this.logic.textContentObj.Jellyfish,this.type="Jellyfish",this.id=this.type+t,this.img=new Image,this.img.src=["./dist/art/jelly1.png","./dist/art/jelly2.png"][h(2)],this.height=25,this.width=15,this.pos=r.pos||this.placer(),this.maxSpeed=.5,this.speed=h(1,5)/100,this.maxEnergy=5,this.energy=this.maxEnergy,this.consumptionRate=.002,this.energyVal=4,this.up=[!0,!1][h(2)],this.right=[!0,!1][h(2)],this.movement1=this.moveSelector(),this.movement2=this.moveSelector(),this.moveChangerOne(),this.moveChangerTwo(),this.dropGametes()}dropGametes(){let t=setTimeout((()=>{this.logic.effectCount++,this.logic.effects["Effect"+this.logic.effectCount]=new u(this.logic.effectCount,this.ctx,this.canvas,this.view,this.logic,{type:"gametes",pos:[this.pos[0],this.pos[1]],size:2})}),h(6e6));this.clearOnDeath.push(t)}beforeIDieCB(){this.trappedPrey&&(this.trappedPrey.trapped=!1),this.clearOnDeath.forEach((t=>{clearTimeout(t)}))}moveSelector=()=>Object.values(this.movementPatterns)[Math.floor(2*Math.random())];placer(){return[h(1,this.arenaWidth-this.width),h(1,this.arenaHeight-this.height)]}coreloop(){this.trapper.coreloop(),this.floater.coreloop(),this.move(),this.draw(),this.view.debugging&&(this.ctx.fillStyle="rgba(0,0,0,1)",this.ctx.font="12px serif",this.ctx.fillText(`${[Math.floor(this.pos[0]),Math.floor(this.pos[1])]}`,this.pos[0]+this.offset[0],this.pos[1]+this.offset[1]),this.ctx.fillRect(this.trapPos[0]+this.offset[0],this.trapPos[1]+this.offset[1],this.trapWidth,this.trapHeight))}move(){this.timeToSwitchMovement&&(Object.values(this.movementSwitches)[Math.floor(Math.random()*Object.values(this.movementSwitches).length)](),this.timeToSwitchMovement=!1),(this.pos[0]>this.arenaWidth-this.width||this.pos[0]<0)&&(this.right=!this.right),(this.pos[1]>this.arenaHeight-this.height||this.pos[1]<0)&&(this.up=!this.up),this.trapper.coreloop(),this.movement1(),this.movement2()}movementSwitches={reverseUp:()=>{this.up=!this.up},reverseSide:()=>{this.right=!this.right},speedUp:()=>{this.speed<this.maxSpeed&&(this.speed+=.1)},slowDown:()=>{this.speed>.3&&(this.speed-=.1)}};draw(){this.drawDenizen()}}class O extends n{constructor(t,e,s,i,a,r){super(e,s,i,a),this.floater=new o(this),this.textBox=this.logic.textContentObj.Turtle,this.type="Turtle",this.id=this.type+t,this.leftImg.src="./dist/art/turtleleft.png",this.rightImg.src="./dist/art/turtleright.png",this.img=this.imgSelector(),this.bobCoef=Math.floor(10*Math.random())+4,this.bobSpeed=(Math.floor(3*Math.random())+.1)/30,this.trackCoef=0,this.up=[!0,!1][Math.floor(2*Math.random())],this.inArena=!1,this.maxEnergy=20,this.eatFoodThreshold=15,this.energy=h(10,20),this.energyUseCoef=.002,this.energyVal=30,this.huntingThreshold=13,this.mouthSize=8,this.hunting=!1,this.width=80,this.height=32,this.maxSpeed=1,this.speed=1,this.pos=this.placer(),this.timeToLeave=!1,this.leaveTimer(),this.playingSeagrassEffect=!1,this.eatingSeagrass=!1,this.consumptionRate=.005,this.recentlyAte=!1,this.movement1=this.moveSelector(),this.movement2=this.moveSelector(),this.moveChangerOne(),this.moveChangerTwo(),this.mouthEater=new l(this,{mouthHeight:this.mouthSize,mouthWidth:this.mouthSize,leftMouthYAdjustment:this.height/2-8,leftMouthXAdjustment:0,rightMouthXAdjustment:this.width-this.mouthSize,rightMouthYAdjustment:this.height/2-8})}leaveTimer(){let t=setTimeout((()=>{this.timeToLeave=!0,this.eatingSeagrass=!1,this.playingSeagrassEffect=!1}),Math.floor(6e4*Math.random())+6e4);this.clearOnDeath.push(t)}placer(){return[this.right?0-this.width:this.arenaWidth,h(this.arenaHeight-this.height)]}enterArena(){this.right?(this.pos[0]>0&&(this.inArena=!0),this.pos[0]+=this.speed):(this.pos[0]<this.arenaWidth-this.width&&(this.inArena=!0),this.pos[0]-=this.speed)}debugger(){}deleteTurtle(){(this.pos[0]+this.width<0||this.pos[0]>this.arenaWidth)&&(this.dead=!0,this.logic.recentlyDeadDenizens.push(this))}seagrassEffect(){let t;this.playingSeagrassEffect=!0,t=this.right?[this.pos[0]+this.width,this.pos[1]+10]:[this.pos[0],this.pos[1]+10],this.logic.effectCount++,this.logic.effects["Effect"+this.logic.effectCount]=new u(this.logic.effectCount,this.ctx,this.canvas,this.view,this.logic,{type:"eatingSeaweed",pos:t,parent:this})}coreloop(){if(this.inDangerZone&&this.escapingDangerZone&&(this.pos[0]<0+this.width?this.pos[0]+=.3:this.pos[0]-=.3),this.mouthEater.coreloop(),this.hunting||(this.eatingSeagrass=!1),this.hunting&&this.eatingSeagrass&&!this.playingSeagrassEffect&&this.seagrassEffect(),this.drawDenizen(),this.speedModulator(),this.debugger(),this.timeToLeave)return this.enterArena(),void this.deleteTurtle();this.inArena?this.eatingSeagrass||this.move():this.enterArena(),this.consumeEnergy(),this.hunting&&this.consumeFood(),this.behaviorChanger(),this.dangerZoneProtocol()}consumeFood(){this.eatingSeagrass&&"Seaweed"===this.hunting.type&&(this.floater.coreloop(),this.energy=Math.min(this.maxEnergy,this.energy+this.consumptionRate),this.hunting.energyVal-=this.consumptionRate)}speedModulator(){this.speed-=.005,this.speed<.2&&(this.speed=this.maxSpeed)}}class B{constructor(t,e,s,i,h,a,o){this.ctx=t,this.canvas=e,this.view=s,this.logic=i,this.type=h,this.text=a,this.leading=50,this.indexTracker=0,this.totalLines=0,this.textBoxInnerMargin=25,this.textBoxOuterMargin=Math.floor(this.canvas.width/12),this.startTextAtX=this.textBoxOuterMargin+this.textBoxInnerMargin,this.startHeaderAtY=this.startTextAtX,this.startTextAtY=this.ctx.measureText(this.type).actualBoundingBoxDescent+this.textBoxInnerMargin,this.font=24,this.img=new Image,this.img.src=`./dist/images/${o}`,this.imgHeight=(this.canvas.height-2*this.textBoxOuterMargin)/3,this.imgWidth=1.5*this.imgHeight,this.topPlacementOfImage=this.canvas.height-this.textBoxInnerMargin-this.textBoxOuterMargin-this.imgHeight,this.bottomLimitOfText=this.topPlacementOfImage-this.textBoxInnerMargin,this.rightLimitOfText=this.canvas.width-this.textBoxInnerMargin-this.textBoxOuterMargin,this.textR=234,this.textB=221,this.textG=212,this.textFader=0,this.fadeInSpeed=.025}resetTextBox(){this.leading=50,this.indexTracker=0,this.totalLines=0,this.font=24,this.textFader=0}recalculateBounds(){this.topPlacementOfImage=this.canvas.height-this.textBoxInnerMargin-this.textBoxOuterMargin-this.imgHeight,this.rightLimitOfText=this.canvas.width-this.textBoxInnerMargin-this.textBoxOuterMargin,this.bottomLimitOfText=this.topPlacementOfImage-this.textBoxInnerMargin,this.imgHeight=(this.canvas.height-2*this.textBoxOuterMargin)/3,this.imgWidth=1.5*this.imgHeight,this.startTextAtX=this.textBoxOuterMargin+this.textBoxInnerMargin,this.startHeaderAtY=this.startTextAtX+15,this.startTextAtY=this.ctx.measureText(this.type).actualBoundingBoxDescent+this.textBoxInnerMargin/2+this.startHeaderAtY}coreloop(){this.ctx.fillStyle="rgba(0,64,100,.85)",this.ctx.fillRect(this.textBoxOuterMargin,this.textBoxOuterMargin,this.canvas.width-2*this.textBoxOuterMargin,this.canvas.height-2*this.textBoxOuterMargin),this.ctx.drawImage(this.img,this.canvas.width/2-this.imgWidth/2,this.topPlacementOfImage,this.imgWidth,this.imgHeight),this.ctx.measureText(this.type).width,this.ctx.fillStyle=`rgba(${this.textR},${this.textB},${this.textG},${this.textFader})`,this.textFader<1&&(this.textFader+=this.fadeInSpeed),this.ctx.font=1.4*this.font+"px serif",this.ctx.fillText(this.type,this.canvas.width/2-this.ctx.measureText(this.type).width/2,this.startHeaderAtY),this.textParser(),this.recalculateBounds(),this.totalLines=1,this.indexTracker=0}textParser(){let t=this.text.split(" "),e="",s="";for(this.ctx.font=`${this.font}px serif`;this.indexTracker<t.length;)for(let i=this.indexTracker;i<t.length;i++){let h=t[i];if(s+=h,this.startTextAtX+this.ctx.measureText(s).width>this.rightLimitOfText||i===t.length-1){let a=this.ctx.measureText(s).actualBoundingBoxDescent+this.startTextAtY+this.leading*this.totalLines;if(a>this.bottomLimitOfText){this.font-=1,this.leading-=2.5,this.indexTracker=0;break}i===t.length-1&&this.ctx.measureText(s+h).width<this.canvas.width-2*this.textBoxOuterMargin-2*this.textBoxInnerMargin?e+=h:i===t.length-1&&this.ctx.fillText(h,this.startTextAtX,this.startTextAtY+this.leading*(this.totalLines+1)),this.ctx.fillText(e,this.startTextAtX,this.startTextAtY+this.leading*this.totalLines),this.totalLines+=1,e="",s="",i===t.length-1?(this.indexTracker=i+1,a<this.bottomLimitOfText-3*this.textBoxInnerMargin&&(this.font+=1,this.leading+=2.5)):this.indexTracker=i;break}e+=h,s+=" ",e+=" "}}}class I{constructor(t,e,s){this.bounds=t,this.capacity=e,this.denizens=[],this.nodes=[],this.ctx=s.ctx,this.view=s}draw(){this.ctx.fillStyle="rgba(255,0,0,.5)",this.ctx.fillRect(this.bounds.x+this.view.offset[0],this.bounds.y+this.view.offset[1],this.bounds.width,2),this.ctx.fillRect(this.bounds.x+this.view.offset[0],this.bounds.y+this.view.offset[1],2,this.bounds.height);for(const t of this.nodes)t.draw()}insert(t,e=0){if(e>1e3&&console.log(t),!this.bounds.contains(t))return!1;if(this.denizens.length<this.capacity)return this.denizens.push(t),!0;this.nodes.length||this.subdivide();for(const s of this.nodes)if(s.insert(t,e+1))return!0;return!1}subdivide(){const t=this.bounds.x,e=this.bounds.y,s=this.bounds.width/2,i=this.bounds.height/2,h=new I(new P(t,e,s,i),this.capacity+1,this.view),a=new I(new P(t+s,e,s,i),this.capacity+1,this.view),o=new I(new P(t,e+i,s,i),this.capacity+1,this.view),r=new I(new P(t+s,e+i,s,i),this.capacity+1,this.view);this.nodes=[h,a,o,r];for(const t of this.denizens)for(const e of this.nodes)e.insert(t);this.denizens=[]}queryType(t,e){const s=[];for(const e of this.denizens)e.constructor===t&&s.push(e);for(const e of this.nodes)s.push(...e.queryType(t));return s}queryRange(t,e,s,i){s||console.log(t,e,s);const h=[];if(!this.bounds.intersects(t))return h;for(const a of this.denizens)s.id!==a.id&&t[e](a,i)&&h.push(a);for(const a of this.nodes)h.push(...a.queryRange(t,e,s,i));return h}}class P{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}overlaps(t){let e={left:this.x,right:this.x+this.width,top:this.y,bottom:this.y+this.height},s={left:t.pos[0],right:t.pos[0]+t.width,top:t.pos[1],bottom:t.pos[1]+t.height};return this.recOverlapCheck(e,s)||this.recOverlapCheck(s,e)}partialOverlap(t){let e={left:this.x,right:this.x+this.width,top:this.y,bottom:this.y+this.height},s={left:t.pos[0],right:t.pos[0]+t.width,top:t.pos[1],bottom:t.pos[1]+t.height};return this.recOverlapCheck(e,s)||this.recOverlapCheck(s,e)||this.rectFullyInside(e,s)||this.rectFullyInside(s,e)}fullyOverlaps(t){let e={left:this.x,right:this.x+this.width,top:this.y,bottom:this.y+this.height},s={left:t.pos[0],right:t.pos[0]+t.width,top:t.pos[1],bottom:t.pos[1]+t.height};return this.rectFullyInside(e,s)||this.rectFullyInside(s,e)}recPartialOverlap(t,e){return e.left<=t.left&&e.right>=t.right&&e.top<=t.top&&e.bottom>=t.bottom||e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom}recOverlapCheck(t,e){return e.left<=t.right&&e.right>=t.left&&e.top<=t.bottom&&e.bottom>=t.top}rectFullyInside(t,e){return t.left>=e.left&&t.right<=e.right&&t.top>=e.top&&t.bottom<=e.bottom}contains(t){let[e,s]=t.pos;return e>=this.x&&e<=this.x+this.width&&s>=this.y&&s<=this.y+this.height}intersects(t){return!(t.x-t.width>this.x+this.width||t.x+t.width<this.x-this.width||t.y-t.height>this.y+this.height||t.y+t.height<this.y-this.height)}}class j{constructor(t){this.logic=t}coreloop(){this.denizensHuntWhenHungry(),this.denizensWithMouthsCanFindSomethingElseToEat(),this.denizensWithMouthsEatPrey(),this.trappersTrapPrey(),this.denizensMate(),this.fishFleeFromSharks(),this.scavengersEatDeadCreatures()}denizensHuntWhenHungry(){for(;this.logic.hungryDenizenArr.length;){let t=this.logic.hungryDenizenArr.pop();this.findNearestFood(t)}}findNearestFood(t){let e,s=[],i=1/0,h=this.unpackAllPreySpecies(t);for(const a of h){let h=Math.abs(t.pos[0]-a.pos[0]),o=Math.abs(t.pos[1]-a.pos[1]);h+o<i&&(i=h+o,s=a.pos,e=a)}t.hunting=e,t.nearestFoodCords=s}unpackAllPreySpecies(t){let e=[];return Object.values(t.preySpecies).forEach((t=>{e=e.concat(Object.values(t))})),e}denizensWithMouthsCanFindSomethingElseToEat(){for(let t=0;t<this.logic.predatorsWithMouthsArr.length;t++){let e=this.logic.predatorsWithMouthsArr[t];e.hunting&&(e.hunting.id in e.preySpecies[e.hunting.type]||(e.hunting=!1,e.nearestFoodCords=[]))}}denizensWithMouthsEatPrey(){for(let t=0;t<this.logic.predatorsWithMouthsArr.length;t++){let e=this.logic.predatorsWithMouthsArr[t];if(e.energy>e.eatFoodThreshold)continue;if(e.mating)continue;let s=this.logic.view.quadtree.queryRange(new P(e.mouthEater.mouthPos[0],e.mouthEater.mouthPos[1],e.mouthEater.mouthWidth,e.mouthEater.mouthHeight),"overlaps",e);for(const t of s)if(e.preySpecies[t.type]){if("Seaweed"===t.type){e.eatingSeagrass=!0,e.hunting=t;continue}if(t.dead)continue;t.dead=!0,this.logic.recentlyDeadDenizens.push(t),e.energy=e.energy+t.energyVal>e.maxEnergy?e.maxEnergy:e.energy+t.energyVal,e.foodEaten++,e.hunting=!1,e.afterIEatCB()}}}trappersTrapPrey(){for(let t=0;t<this.logic.trappersArr.length;t++){let e=this.logic.trappersArr[t],s=e.trapper;if(e.trappedPrey)continue;if(e.mating)continue;let i=this.logic.view.quadtree.queryRange(new P(s.trapPos[0],s.trapPos[1],s.trapWidth,s.trapHeight),"fullyOverlaps",e);for(const t of i)if(e.preySpecies[t.type]){if(t.dead)continue;t.trapped=s.trapPos,t.trappedPosDelta=[s.trapPos[0]-t.pos[0],s.trapPos[1]-t.pos[1]],e.trappedPrey=t,e.afterITrapCB()}}}denizensMate(){let t=Object.values(this.logic.matingDenizensObj);for(let e=0;e<t.length;e++){let s,i=t[e],h=this.logic.view.quadtree.queryRange(new P(i.pos[0],i.pos[1],i.width,i.height),"contains",i);for(const t of h)if(i.constructor===t.constructor&&t.seekingMate){s=t;break}s&&(i.mate(!0),i.seekingMate=!1,delete this.logic.matingDenizensObj[i.id],s.mate(),s.seekingMate=!1,delete this.logic.matingDenizensObj[s.id])}}fishFleeFromSharks(){let t=[...Object.values(this.logic.garabaldi),...Object.values(this.logic.garabaldiBabies),...Object.values(this.logic.bass),...Object.values(this.logic.bassBabies)];for(let e=0;e<t.length;e++){let s=t[e];s.mating||s.fleeing||this.findNearestPredator(s,f)}}findNearestPredator(t,e){let s,i=this.logic.view.quadtree.queryRange(new P(t.pos[0]-100,t.pos[1]-100,200,200),"overlaps",t);for(const t of i)if(t instanceof e){s=t;break}s&&(t.fleeing=!0,t.fleeFromCoords=s.pos,setTimeout((()=>{t.fleeing=!1,t.fleeFromCoords=[]}),1e3))}scavengersEatDeadCreatures(){for(let t=0;t<this.logic.scavengersArr.length;t++){let e=this.logic.scavengersArr[t];if(e.scavenging)continue;if(e.mating)continue;let s=this.logic.view.quadtree.queryRange(new P(e.pos[0],e.pos[1],e.width,e.height),"overlaps",e);for(let t=0;t<s.length;t++){if(!(s[t]instanceof D))continue;let i=s[t];e.scavenging=i,e.speed=0}}}}class A extends s{constructor(t,e,s,i,a){super(e,s,i,a),this.trapper=new y(this,{trapHeight:4,trapWidth:6}),this.textBox=this.logic.textContentObj.Otter,this.type="Otter",this.id=this.type+t,this.ctx=e,this.canvas=s,this.view=i,this.logic=a,this.upRight=new Image,this.upRight.src="./dist/art/otter/otterUpRight.png",this.upLeft=new Image,this.upLeft.src="./dist/art/otter/otterUpLeft.png",this.downRight=new Image,this.downRight.src="./dist/art/otter/otterDownRight.png",this.downLeft=new Image,this.downLeft.src="./dist/art/otter/otterDownLeft.png",this.height=60,this.width=30,this.maxSpeed=1,this.appearedOnScreen=!1,this.pos=[],this.centerX=h(this.arenaWidth),this.centerY=0,this.radius=h(this.arenaHeight/2,this.arenaHeight-50),this.right=[!0,!1][h(2)],this.angle=this.right?135:0,this.trappedPrey=!1,this.imgSelector()}beforeIDieCB(){this.trappedPrey&&(this.trappedPrey.trapped=!1),this.clearOnDeath.forEach((t=>{clearTimeout(t)}))}imgSelector(){this.img=this.right?this.downRight:this.downLeft}moveInACircle(){this.right?this.angle-=.001:this.angle+=.001,this.pos[0]=this.centerX+this.radius*Math.cos(this.angle),this.pos[1]=this.centerY+this.radius*Math.sin(this.angle)}coreloop(){this.rotateImage(this.img,this.pos[0],this.pos[1],this.width,this.height),this.moveInACircle(),!this.appearedOnScreen&&this.pos[0]>0&&this.pos[1]>0&&this.pos[0]+this.width<this.arenaWidth&&(this.appearedOnScreen=!0),this.trapPlacer(),(this.appearedOnScreen&&this.pos[1]+this.height<0||this.pos[0]+this.width<0||this.pos[0]-this.width>this.arenaWidth)&&(this.dead=!0,this.logic.recentlyDeadDenizens.push(this))}rotateImage(){this.ctx.save(),this.ctx.translate(this.pos[0]+this.width/2+this.offset[0],this.pos[1]+this.height/2+this.offset[1]),this.right?this.ctx.rotate(45*(this.angle-135)*Math.PI/180):this.ctx.rotate(45*this.angle*Math.PI/180),this.ctx.translate(-this.pos[0]-this.width/2-this.offset[0],-this.pos[1]-this.height/2-this.offset[1]),this.drawDenizen(),this.ctx.restore()}trapPlacer(){const t=this.width/2,e=this.height/2;let s,i;this.right?(s=this.width/2-10,i=-this.height/2+15):(s=-this.width/2+20,i=this.height/2-10);const h=s*Math.cos(this.angle)-i*Math.sin(this.angle),a=s*Math.sin(this.angle)+i*Math.cos(this.angle),o=this.pos[0]+t+h,r=this.pos[1]+e+a;this.trapper.trapPos[0]=o,this.trapper.trapPos[1]=r}}class E extends s{constructor(t,e,s,i,h,a){super(e,s,i,h),this.type="Polyp",this.id=this.type+t,this.width=1,this.height=1,this.pos=[a.pos[0],this.arenaHeight-this.height],this.img=new Image,this.img.src="./dist/art/polyp.png",this.mature=!1}growUp(){this.width+=.005,this.height+=.005,this.pos[1]=[this.arenaHeight-this.height],this.width>20&&(this.mature=!0,this.dieEventually(),this.spawnJellyFish())}spawnJellyFish(){let t=setTimeout((()=>{this.logic.spawnDenizen(this),this.spawnJellyFish()}),h(1e4)+1e4);this.clearOnDeath.push(t)}dieEventually(){setTimeout((()=>{this.dead=!0,this.logic.recentlyDeadDenizens.push(this)}),h(6e4)+6e4)}coreloop(){this.mature||this.growUp(),this.drawDenizen()}}class F{constructor(t){this.logic=t,this.algaeSpawnInterval=1e3,this.denizensSpawnInIncrements(this.algaeSpawnInterval,"algaeCount","algae",r,{clustersObj:this.logic.seaweedClusters}),this.otterDiveInterval=15e3,this.denizensSpawnInIncrements(this.otterDiveInterval,"otterCount","otters",A),this.clusterSpawnInterval=25e3,this.denizensSpawnInIncrements(this.clusterSpawnInterval,"seaweedClusterCount","seaweedClusters",b,{}),this.turtleSpawnInterval=2e4,this.denizensSpawnInIncrements(this.turtleSpawnInterval,"turtleCount","turtles",O,{})}coreloop(){this.seaweedFinder()}seaweedFinder(){this.logic.seaweedClusters&&Object.values(this.logic.seaweedClusters).forEach((t=>{this.logic.seaweedSpots[t.pos[0]+h(-10,0)]=t}))}denizensSpawnInIncrements(t,e,s,i,h){setTimeout((()=>{this.logic[e]++,this.logic[s][i.name+String(this.logic[e])]=new i(this.logic[e],this.logic.ctx,this.logic.canvas,this.logic.view,this.logic,h),this.denizensSpawnInIncrements(t,e,s,i,h)}),Math.floor(Math.random()*t)+t)}assignFoodWeb(){d.prototype.preySpecies={Algae:this.logic.algae},p.prototype.preySpecies={Algae:this.logic.algae},C.prototype.preySpecies={Algae:this.logic.algae,GarabaldiBaby:this.logic.garabaldiBabies,CrabBaby:this.logic.crabBabies},M.prototype.preySpecies={Algae:this.logic.algae},T.prototype.preySpecies={RockfishBaby:this.logic.rockfishBabies,GarabaldiBaby:this.logic.garabaldiBabies,CrabBaby:this.logic.crabBabies},k.prototype.preySpecies={Algae:this.logic.algae},f.prototype.preySpecies={Garabaldi:this.logic.garabaldi,GarabaldiBaby:this.logic.garabaldiBabies,Bass:this.logic.bass,BassBaby:this.logic.bassBabies,Turtle:this.logic.turtles},x.prototype.preySpecies={GarabaldiBaby:this.logic.garabaldiBabies,BassBaby:this.logic.bassBabies},z.prototype.preySpecies={GarabaldiBaby:this.logic.garabaldiBabies,BassBaby:this.logic.bassBabies,FishEgg:this.logic.eggs},A.prototype.preySpecies={Crab:this.logic.crabs,CrabBaby:this.logic.crabBabies,SeaUrchin:this.logic.seaUrchins},O.prototype.preySpecies={Seaweed:this.logic.seaweed,Jellyfish:this.logic.jellyfish}}assignSpeciesObjects(){d.prototype.speciesObject=this.logic.garabaldi,p.prototype.speciesObject=this.logic.garabaldiBabies,C.prototype.speciesObject=this.logic.rockfish,M.prototype.speciesObject=this.logic.rockfishBabies,T.prototype.speciesObject=this.logic.bass,k.prototype.speciesObject=this.logic.bassBabies,r.prototype.speciesObject=this.logic.algae,f.prototype.speciesObject=this.logic.sharks,m.prototype.speciesObject=this.logic.eggs,u.prototype.speciesObject=this.logic.effects,b.prototype.speciesObject=this.logic.seaweedClusters,D.prototype.speciesObject=this.logic.deadCreatures,z.prototype.speciesObject=this.logic.jellyfish,x.prototype.speciesObject=this.logic.crabs,v.prototype.speciesObject=this.logic.crabBabies,A.prototype.speciesObject=this.logic.otters,i.prototype.speciesObject=this.logic.seaUrchins,O.prototype.speciesObject=this.logic.turtles,w.prototype.speciesObject=this.logic.seaweed,E.prototype.speciesObject=this.logic.polyps}}class R{constructor(t,e,s){this.ctx=t,this.canvas=e,this.view=s,this.score=0,this.scoreTrackObj={Garibaldi:!1,Rockfish:!1,"Kelp Bass":!1,Algae:!1,Jellyfish:!1,Otter:!1,Crab:!1,Rock:!1,Shark:!1,Turtle:!1,"Sea Urchin":!1,Kelp:!1,"Fish Egg":!1,Corpse:!1},this.textContentObj={"Kelp Bass":new B(t,e,s,this,"Kelp Bass","The kelp bass (Paralabrax clathratus) is a striking fish found in the Pacific kelp biome. These fish are voracious predators, feeding on a variety of invertebrates and small fish. They are often seen swimming near the surface of the water, using their excellent eyesight to hunt for prey. Interestingly, kelp bass can change their coloration to blend in with their surroundings, making them excellent at camouflaging themselves from both predators and prey. Despite their name, kelp bass don't actually eat kelp – instead, they rely on the kelp forest's many inhabitants for sustenance. Kelp bass are an important species in the kelp forest ecosystem, helping to keep populations of smaller organisms in check.","kelpBass.jpeg"),Rockfish:new B(t,e,s,this,"Rockfish","Rockfish inhabit the rocky reefs of the Pacific kelp biome. These fish come in a variety of colors and patterns, from vibrant oranges and reds to more muted grays and browns. They are an important part of the kelp forest ecosystem, serving as both predator and prey. Rockfish are known for their longevity – some species can live for up to 100 years. They also have a unique reproductive strategy called live birth, where the female carries her young inside her body until they are fully developed. Unfortunately, many species of rockfish are overfished, leading to population declines and concerns for their conservation.","rockfish.jpeg"),Kelp:new B(t,e,s,this,"Kelp","Kelp is one of the defining features of the Pacific kelp forest biome, forming dense forests of long, leafy fronds that provide a complex and vital habitat for a variety of marine organisms. Kelp is a type of seaweed that can grow up to 100 feet tall and is anchored to the ocean floor by a holdfast. In addition to providing food and shelter for countless species, kelp also helps to mitigate the effects of climate change by sequestering carbon dioxide from the atmosphere. However, rising ocean temperatures and ocean acidification, both of which are caused by climate change, are posing a threat to kelp populations. As the oceans warm and become more acidic, kelp growth rates are slowing down, and some areas are experiencing mass die-offs of kelp forests.","kelp.jpeg"),Algae:new B(t,e,s,this,"Algae","Algae are some of the most important organisms in the Pacific kelp forest ecosystem. A crucial type of algae is the red algae, which includes species like coralline algae and rhodophytes. These algae provide a source of food and shelter for a variety of organisms in the kelp forest, and can also play an important role in regulating the pH of the ocean. While algae may not be as charismatic as some of the larger animals in the kelp forest, they are an essential component of this complex ecosystem, and help to support a diverse community of marine life.","algae.webp"),"Sea Urchin":new B(t,e,s,this,"Sea Urchin","Sea urchins are one of the most important species in the Pacific kelp forest. These spiky creatures play a crucial role in controlling the growth of algae, which could otherwise overtake and harm the kelp. Unfortunately, rising sea temperatures and ocean acidification are causing a decline in sea urchin populations, which is having a cascading effect on the entire kelp forest ecosystem. Despite their importance, sea urchins are often misunderstood and seen as a nuisance, with some species having venomous spines that can be harmful to humans. It's essential to handle them with care and appreciate their vital role in the ocean.","sea_urchin.jpeg"),"Fish Egg":new B(t,e,s,this,"Fish Egg","Fish eggs are a crucial component of the Pacific kelp forest ecosystem. These tiny, transparent orbs contain the next generation of fish and provide food for a variety of marine creatures, including birds and larger fish. Some species of fish, such as rockfish and lingcod, lay their eggs in kelp fronds to protect them from predators. Other species, like the leopard shark, deposit their eggs directly on the ocean floor. Fish eggs are also a popular food source for humans, with salmon roe being a delicacy in many cultures. However, overfishing and pollution threaten the survival of many fish species and the vital role they play in the kelp forest ecosystem.","fish_egg.jpeg"),Turtle:new B(t,e,s,this,"Turtle","The sea turtle and loggerhead turtle can both be found in the Pacific kelp forest. These turtles are herbivores and play a critical role in the health and balance of the ecosystem. They consume large quantities of algae, which helps to prevent overgrowth and maintains a healthy population of kelp. Turtles are also important prey for sharks. Additionally, their waste contributes to nutrient cycling, supporting the growth of microorganisms and small plants. Turtles face threats such as habitat loss, pollution, and climate change. As iconic members of this underwater world, green sea turtles and loggerhead turtles serve as a reminder of the beauty and diversity of our oceans and the vital role that every species plays in their ecosystems.","turtle.jpeg"),Corpse:new B(t,e,s,this,"Corpse","Death is an inevitable part of life in the Pacific kelp forest, and the corpses of the denizens of this underwater world play an important role in sustaining the ecosystem. When a fish or other animal dies, its body sinks to the ocean floor, where it becomes a feast for scavengers like crabs and sea stars. As the corpse decomposes, it releases nutrients into the water, which are absorbed by algae and other plants in the kelp forest. This process, known as nutrient cycling, helps to maintain the health and productivity of the ecosystem. In addition to providing nutrients, dead organisms can also create new habitats for other creatures. ","corpse.jpeg"),Shark:new B(t,e,s,this,"Shark","Sharks are some of the most iconic predators of the ocean, and several species can be found in the Pacific kelp forest. One of the most commonly encountered species is the leopard shark (Triakis semifasciata), which is named for its distinctive pattern of dark spots and stripes. Leopard sharks are not considered dangerous to humans, and are commonly seen by divers and snorkelers in shallow waters. Another species that can be found in the kelp forest is the soupfin shark (Galeorhinus galeus), which is sometimes called the school shark. These sharks can grow up to six feet in length, and are known for their ability to form large schools in the ocean.","shark.png"),Otter:new B(t,e,s,this,"Otter","The sea otter (Enhydra lutris) is a crucial player in maintaining the health of the kelp forest. These adorable creatures are known for their love of shellfish, which they crack open with rocks using their impressive dexterity. Sea otters also play an important role in keeping the kelp forests healthy. They feed on sea urchins, which can overgraze kelp if left unchecked. Sea otters are one of the few animals that use tools, and they have even been known to hold hands while sleeping to keep from drifting away from each other. Sadly, sea otters were hunted to near extinction for their fur in the 18th and 19th centuries, but conservation efforts have helped their populations rebound in some areas.","sea_otter.webp"),Rock:new B(t,e,s,this,"Rock","Congratulations, you clicked on a rock. This was very insightful and brave. Most people would just ignore the rock and say “no reason to click on any rocks.” Not you. You’ll click on rocks all day. No stone left unturned, as your dad used to say.","rock.png"),Garibaldi:new B(t,e,s,this,"Garibaldi","The Garibaldi (Hypsypops rubicundus) is a brightly-colored fish that is native to the rocky reefs and kelp forests of the eastern Pacific Ocean. Their bright orange coloration serves as a warning to potential predators that they are venomous, thanks to a coating of mucus on their skin. These fish are an important part of the kelp forest ecosystem, feeding on small invertebrates and algae, and providing food for larger predators such as sea lions and sharks. Despite being protected in some areas, Garibaldi populations are threatened by overfishing and habitat destruction.","garabaldi.jpeg"),Jellyfish:new B(t,e,s,this,"Jellyfish","The Pacific kelp forest is home to a diverse array of jellyfish species, including the lion's mane jellyfish (Cyanea capillata) and the moon jellyfish (Aurelia aurita). These creatures reproduce by spreading gametes which drift to the ocean floor and become polyps - little plant-like structures which spawn new Jellyfish medusa. Jellyfish populations in the Pacific kelp forest are facing increasing threats due to climate change. Rising ocean temperatures and changes in ocean currents are affecting the distribution and abundance of jellyfish, with some species expanding their ranges and others declining in numbers.","jellyfish.jpeg"),Crab:new B(t,e,s,this,"Crab","Crabs are a common sight in the Pacific kelp forest, where they play an important role in the ecosystem. One of the most well-known species is the Dungeness crab (Metacarcinus magister), which is prized by humans for its sweet, tender meat. Dungeness crabs can be found in shallow waters and prefer to feed on small fish and crustaceans, but will also eat kelp and other algae if food is scarce. Another common species is the graceful kelp crab (Pugettia gracilis), which is named for its slender legs and preference for living among the kelp fronds. These crabs are expert at camouflaging themselves among the kelp, making them difficult to spot. ","crab.jpeg")},this.seaweedClusterCount=25,this.seaUrchinCount=0,this.seaUrchins={},this.seaweedClusters=this.tankPopulator(this.seaweedClusterCount,b,{start:!0}),this.seaweed={},this.seaweedSpots={},this.behaviorController=new j(this),this.natureController=new F(this),this.garabaldiCount=10,this.garabaldiBabyCount=10,this.bassCount=4,this.bassBabyCount=6,this.rockfishCount=10,this.rockfishBabyCount=10,this.algaeCount=100,this.sharkCount=2,this.eggCount=0,this.effectCount=0,this.turtleCount=1,this.deadCreatureCount=0,this.crabCount=10,this.crabBabyCount=6,this.jellyfishCount=20,this.rockCount=20,this.otterCount=0,this.polypCount=0,this.garabaldi=this.tankPopulator(this.garabaldiCount,d,{}),this.garabaldiBabies=this.tankPopulator(this.garabaldiBabyCount,p,{}),this.bass=this.tankPopulator(this.bassCount,T,{}),this.bassBabies=this.tankPopulator(this.bassBabyCount,k,{}),this.rockfish=this.tankPopulator(this.rockfishCount,C,{}),this.rockfishBabies=this.tankPopulator(this.rockfishBabyCount,M,{}),this.sharks=this.tankPopulator(this.sharkCount,f),this.eggs=this.tankPopulator(this.eggCount,m,{}),this.effects=this.tankPopulator(this.effectCount,u,{}),this.turtles=this.tankPopulator(this.turtleCount,O,{}),this.algae=this.tankPopulator(this.algaeCount,r,{clustersObj:this.seaweedClusters}),this.deadCreatures={},this.crabs=this.tankPopulator(this.crabCount,x,{}),this.crabBabies=this.tankPopulator(this.crabBabyCount,v,{pos:[h(50,this.view.arenaWidth-50)]}),this.jellyfish=this.tankPopulator(this.jellyfishCount,z,{}),this.rocks=this.tankPopulator(this.rockCount,S,{}),this.polyps={},this.otters={},this.hungryDenizenArr=[],this.natureController.assignFoodWeb(),this.natureController.assignSpeciesObjects(),this.matingDenizensObj={},this.recentlyDeadDenizens=[]}spawnDenizen(t){let e,s,h,a,o;switch(t.constructor){case d:case T:case C:this.eggCount+=1,e=this.eggCount,s=this.eggs,h="Fishegg",a=m,o={pos:[Math.floor(t.pos[0]),Math.floor(t.pos[1])],parent:t.constructor};break;case M:this.rockCount+=1,e=this.rockCount,s=this.rockfish,h="Rockfish",a=C,o={pos:[t.pos[0],t.pos[1]]};break;case k:this.bassCount+=1,e=this.bassCount,s=this.bass,h="Bass",a=T,o={pos:[t.pos[0],t.pos[1]]};break;case p:this.garabaldiCount+=1,e=this.garabaldiCount,s=this.garabaldi,h="Garabaldi",a=d,o={pos:[t.pos[0],t.pos[1]]};break;case x:this.crabBabyCount+=1,e=this.crabBabyCount,s=this.crabBabies,h="CrabBaby",a=v,o={pos:[Math.floor(t.pos[0]),Math.floor(t.pos[1])]};break;case v:this.crabCount+=1,e=this.crabCount,s=this.crabs,h="Crab",a=x,o={pos:[t.pos[0],t.pos[1]]};break;case w:this.seaUrchinCount+=1,e=this.seaUrchinCount,s=this.seaUrchins,h="SeaUrchin",a=i,o={parent:t,pos:[t.pos[0],t.pos[1]]};break;case E:this.jellyfishCount+=1,e=this.jellyfishCount,s=this.jellyfish,h="Jellyfish",a=z,o={pos:[t.pos[0],t.pos[1]-10]};break;case u:this.polypCount+=1,e=this.polypCount,s=this.polyps,h="Polyp",a=E,o={pos:[t.pos[0],t.pos[1]]};break;case m:return void this.spawnDenizenFish(t)}s[h+e]=new a(e,this.ctx,this.canvas,this.view,this,o)}spawnDenizenFish(t){let e,s,i,h,a={pos:[Math.floor(t.pos[0]),Math.floor(t.pos[1])]};switch(t.parent){case d:this.garabaldiBabyCount++,e=this.garabaldiBabyCount,s=this.garabaldiBabies,i="GarabaldiBaby",h=p;break;case T:this.bassBabyCount++,e=this.bassBabyCount,s=this.bassBabies,i="BassBaby",h=k;break;case C:this.rockfishBabyCount++,e=this.rockfishBabyCount,s=this.rockfishBabies,i="RockfishBaby",h=M}s[i+e]=new h(e,this.ctx,this.canvas,this.view,this,a)}denizenCorpse(t){this.deadCreatureCount++,this.deadCreatures["DeadCreature"+this.deadCreatureCount]=new D(this.deadCreatureCount,this.ctx,this.canvas,this.view,this,t.pos,t)}seaweedUpdater(){for(let t of Object.values(this.seaweedClusters))for(let e of Object.values(t.seaweed))this.seaweed[e.id]=e}reAssignDataObjs(){this.seaweedUpdater(),this.predatorsWithMouthsArr=[...Object.values(this.turtles),...Object.values(this.bassBabies),...Object.values(this.bass),...Object.values(this.garabaldiBabies),...Object.values(this.garabaldi),...Object.values(this.sharks),...Object.values(this.rockfish),...Object.values(this.rockfishBabies)],this.scavengersArr=[...Object.values(this.crabs),...Object.values(this.crabBabies)],this.trappersArr=[...Object.values(this.crabs),...Object.values(this.jellyfish),...Object.values(this.otters)]}coreloop(){this.deleteDeadDenizens(),this.reAssignDataObjs(),this.natureController.coreloop(),this.behaviorController.coreloop(),this.deleteDeadDenizens()}deleteDeadDenizens(){for(;this.recentlyDeadDenizens.length;){let t=this.recentlyDeadDenizens.pop();delete t.speciesObject[t.id]}}tankPopulator(t,e,s){let i={};for(;t>0;)i[e.name+t]=new e(t,this.ctx,this.canvas,this.view,this,s),t--;return i}}class H{constructor(t){this.view=t,this.keys=[],this.mouseIsDownAt=!1,window.addEventListener("keydown",(t=>{"ArrowDown"!==t.code&&"ArrowUp"!==t.code&&"ArrowLeft"!==t.code&&"ArrowRight"!==t.code||-1!==this.keys.indexOf(t.code)||this.keys.push(t.code),t.preventDefault()})),window.addEventListener("keyup",(t=>{"ArrowDown"!==t.code&&"ArrowUp"!==t.code&&"ArrowLeft"!==t.code&&"ArrowRight"!==t.code||this.keys.splice(this.keys.indexOf(t.code),1),t.preventDefault()}))}dragScreen(t){this.view.offset[0]+=t[0]-this.mouseIsDownAt[0],this.view.offset[1]+=t[1]-this.mouseIsDownAt[1],this.mouseIsDownAt=[t[0],t[1]],this.view.updateCamera([])}}class W{constructor(t,e){this.canvas=t,this.mobile=!!e,this.ctx=t.getContext("2d"),this.background=new Image,this.background.src="./dist/art/background.jpeg",this.arenaHeight=Math.max(window.innerHeight,1700),this.arenaWidth=1.5*this.arenaHeight,this.backgroundPos=[this.canvas.width/2-this.arenaWidth/2,this.canvas.height/2-this.arenaHeight/2],this.offset=[this.canvas.width/2-this.arenaWidth/2,this.canvas.height/2-this.arenaHeight/2],this.logic=new R(this.ctx,this.canvas,this),this.input=new H(this),this.cameraSpeedX=0,this.cameraSpeedY=0,this.cameraDriftTimer=0,this.inputTracker=0,this.cameraMaxSpeed=1.5,this.scoreFontSize=24,this.showScore=!1,this.turnOffScore=!1,setTimeout((()=>{this.showScore=!0}),4e4),this.fadeInScore=0,this.allDenizensArr=[this.logic.eggs,this.logic.sharks,this.logic.turtles,this.logic.bass,this.logic.rockfish,this.logic.garabaldi,this.logic.seaweedClusters,this.logic.seaweed,this.logic.algae,this.logic.crabs,this.logic.crabBabies,this.logic.deadCreatures,this.logic.seaUrchins,this.logic.otters,this.logic.jellyfish,this.logic.polyps,this.logic.garabaldiBabies,this.logic.bassBabies,this.logic.rockfishBabies,this.logic.rocks,this.logic.effects],this.bounds=new P(0,0,this.arenaWidth,this.arenaHeight),this.quadtree={},this.ecosystemGraphData=[],this.populateQuad(),this.debugging=!1,this.gameFrame=0,this.introFader=1,this.textBox=null}populateQuad(){this.quadtree=new I(this.bounds,6,this),this.allDenizensArr.forEach((t=>{Object.values(t).forEach((t=>{this.quadtree.insert(t)}))}))}fadeInStart(){this.ctx.fillStyle=`rgba(0,0,0,${this.introFader})`,this.introFader-=.005,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}drawInfoText(){this.textBox&&this.textBox.coreloop()}animate(){this.gameFrame++,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.populateQuad(),this.updateCamera(this.input.keys),this.drawBackround(),this.denizenCoreloop(),this.drawInfoText(),!this.showScore||this.textBox||this.mobile||this.drawScore(),this.introFader>0&&this.fadeInStart(),this.logic.coreloop(),this.debugging&&this.quadtree.draw()}drawScore(){if(this.turnOffScore)return;this.fadeInScore<1&&(this.fadeInScore+=.0025),this.ctx.globalAlpha=this.fadeInScore;let t="Denizens Found";this.ctx.fillStyle=`rgba(255,255,255,${.9*this.fadeInScore})`,this.ctx.font="24px Georgia",this.ctx.fillText(t,50,75);let e=this.ctx.measureText(t).width/2,s=Object.values(this.logic.scoreTrackObj).length,i=0;Object.values(this.logic.scoreTrackObj).forEach((t=>{t&&i++})),this.scoreFontSize>24&&(this.scoreFontSize-=.1),this.ctx.font=`${this.scoreFontSize}px Georgia`,this.ctx.fillText(i,117,142),this.ctx.font="24px Georgia",this.ctx.fillText(s,143,168),this.ctx.beginPath(),this.ctx.moveTo(117,168),this.ctx.lineTo(153,132),this.ctx.lineWidth=3,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(50+e,150,50+this.scoreFontSize/2-12,0,2*Math.PI),this.ctx.fillStyle=`rgba(255,255,255,${.4*this.fadeInScore})`,this.ctx.fill(),this.ctx.globalAlpha=1}drawBackround(){this.ctx.drawImage(this.background,this.backgroundPos[0],this.backgroundPos[1],this.arenaWidth,this.arenaHeight),this.ctx.fillStyle="rgba(0,0,0,.3)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}captureEcosystemGraphData(){}drawEcosystemGraph(){}drawEcoLine(t,e,s){}drawTextBox(){}updateCamera(t){!this.cameraSpeedX&&!this.cameraSpeedY||t.length?this.inputTracker=0:(this.inputTracker++,this.inputTracker>200&&(this.cameraSpeedX=0,this.cameraSpeedY=0,this.inputTracker=0)),this.offset[0]>=0&&(this.offset[0]=0),this.offset[0]<=-this.arenaWidth+this.canvas.width&&(this.offset[0]=-this.arenaWidth+this.canvas.width),this.offset[1]>=0&&(this.offset[1]=0),this.offset[1]<=-this.arenaHeight+this.canvas.height&&(this.offset[1]=-this.arenaHeight+this.canvas.height),this.backgroundPos[0]=this.offset[0],this.backgroundPos[1]=this.offset[1],(this.inputTracker||t.length)&&(t.includes("ArrowRight")?(this.cameraSpeedX-=.025,this.cameraDriftTimer=10):t.includes("ArrowLeft")?(this.cameraSpeedX+=.025,this.cameraDriftTimer=10):this.cameraDriftTimer>0?(this.cameraDriftTimer-=.05,this.cameraSpeedX>0?this.cameraSpeedX-=.008:this.cameraSpeedX+=.008):this.cameraSpeedX>0?this.cameraSpeedX-=.025:this.cameraSpeedX+=.025,t.includes("ArrowUp")?this.cameraSpeedY+=.025:t.includes("ArrowDown")?this.cameraSpeedY-=.025:this.cameraDriftTimer>0?(this.cameraDriftTimer-=.05,this.cameraSpeedY>0?this.cameraSpeedY-=.008:this.cameraSpeedY+=.008):this.cameraSpeedY>0?this.cameraSpeedY-=.025:this.cameraSpeedY+=.025,Math.abs(this.cameraSpeedX)>this.cameraMaxSpeed&&(this.cameraSpeedX=this.cameraMaxSpeed*(this.cameraSpeedX>0?1:-1)),Math.abs(this.cameraSpeedY)>this.cameraMaxSpeed&&(this.cameraSpeedY=this.cameraMaxSpeed*(this.cameraSpeedY>0?1:-1)),this.offset[0]+=this.cameraSpeedX,this.offset[1]+=this.cameraSpeedY)}denizenCoreloop(){this.allDenizensArr.forEach((t=>{Object.values(t).forEach((t=>{t.coreloop()}))}))}}const U=document.getElementById("canvas1");U.height=window.innerHeight,U.width=window.innerWidth;const L=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i);let Y=new class{constructor(s,i){this.ctx=s.getContext("2d"),this.canvas=s,this.sound=new e,this.view=new W(s,i),this.intro=new t(s,i),this.mobile=i,this.touch=null,this.collisionArr=null,this.showIntro=!0,this.touchRect=[],this.animate()}animate(){this.showIntro?(this.intro&&!this.intro.simStart?this.intro.animate():(this.intro=null,this.view.animate()),this.sound.kickOffIntroScore&&this.sound.playingSong.paused&&this.sound.playNextTrack()):this.view.animate(),this.touchRect.length&&(this.ctx.fillStyle="rgba(255,255,255,1",this.ctx.fillRect(this.touchRect[0],this.touchRect[1],this.touchRect[2],this.touchRect[2])),requestAnimationFrame(this.animate.bind(this))}}(U,L);const q=document.getElementById("sound-button");q.addEventListener("click",(t=>{t.stopPropagation(),"sound-on"===q.classList[1]?(q.classList.remove("sound-on"),q.classList.add("sound-off"),q.innerHTML='<i class="fa-solid fa-volume-xmark">',Y.sound.muteAllSounds()):(q.classList.remove("sound-off"),q.classList.add("sound-on"),q.innerHTML='<i class="fa-solid fa-volume-high">',Y.sound.unmuteAllSounds())})),window.addEventListener("keydown",(t=>{Y.sound.kickOffIntroScore||"Space"===t.code&&(t.preventDefault(),Y.sound.playIntroScore(),Y.intro.sequenceStep=1)})),U.addEventListener("mousedown",(t=>{t.preventDefault(),Y.view.input.mouseIsDownAt=[t.x,t.y]})),U.addEventListener("mousemove",(t=>{t.preventDefault(),Y.view.input.mouseIsDownAt&&Y.view.input.dragScreen([t.x,t.y])})),U.addEventListener("mouseup",(t=>{t.preventDefault(),Y.view.input.mouseIsDownAt=!1})),U.addEventListener("click",(t=>{if(Y.view.input.mouseIsDownAt=!1,!Y.sound.kickOffIntroScore&&Y.showIntro&&(Y.sound.playIntroScore(),Y.intro.sequenceStep=1),!Y.intro||Y.intro.simStart||!Y.showIntro)if(Y.view.textBox)Y.view.textBox.resetTextBox(),Y.view.textBox=null;else{let e=Y.view.quadtree.queryRange(new P(t.x-Y.view.offset[0]-5,t.y-Y.view.offset[1]-5,10,10),"partialOverlap",{id:null},!0);if(e.length){let t;for(let s=0;s<e.length;s++)if("Seaweed"!==e[s].type||s===e.length-1){t=e[s].textBox;break}Y.view.textBox=t,Y.view.fadeInScore=.5,Y.view.showScore=!0,Y.view.logic.scoreTrackObj[t.type]||(Y.view.logic.scoreTrackObj[t.type]=!0,Y.view.logic.score+=1,Y.view.scoreFontSize=42)}}})),window.addEventListener("resize",(t=>{U.height=t.currentTarget.innerHeight,U.width=t.currentTarget.innerWidth,X(window.innerWidth)}));const X=t=>{const e=document.getElementById("github-button"),s=document.getElementById("linkedin-button");t<700||Y.mobile?(e.classList.add("hide"),s.classList.add("hide")):(e.classList.remove("hide"),s.classList.remove("hide"))};X(),U.addEventListener("touchstart",(t=>{t.preventDefault();let e=t.touches[0];if(Y.view.input.mouseIsDownAt=[e.clientX,e.clientY],Y.sound.kickOffIntroScore||(Y.sound.playIntroScore(),Y.intro.sequenceStep=1),!Y.intro||Y.intro.simStart||!Y.showIntro)if(Y.view.textBox)Y.view.textBox.resetTextBox(),Y.view.textBox=null;else{let t=Y.view.quadtree.queryRange(new P(e.clientX-Y.view.offset[0]-25,e.clientY-Y.view.offset[1]-25,50,50),"overlaps",{id:null},!0);if(t.length){let e;for(let s=0;s<t.length;s++)if("Seaweed"!==t[s].type||s===t.length-1){e=t[s].textBox;break}Y.view.textBox=e,Y.view.fadeInScore=.5,Y.view.showScore=!0,Y.view.logic.scoreTrackObj[e.type]||(Y.view.logic.scoreTrackObj[e.type]=!0,Y.view.logic.score+=1,Y.view.scoreFontSize=42)}}})),U.addEventListener("touchmove",(t=>{t.preventDefault();let e=t.touches[0];Y.view.input.mouseIsDownAt&&Y.view.input.dragScreen([e.clientX,e.clientY])})),U.addEventListener("touchend",(t=>{t.preventDefault(),Y.view.input.mouseIsDownAt=!1}))}();